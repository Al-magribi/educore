const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LearningHeader-piOYd0yl.js","assets/index-DJgzJvx0.js","assets/vendor-kOq7Q5-U.js","assets/charts-4CCI6hAs.js","assets/index-DOw7bMS2.css","assets/plus-BlyBk2I3.js","assets/LearningFilters-CerB-3YM.js","assets/layers-BM2-Q3cP.js","assets/index-ZAZRIL-n.js","assets/index-CsPvpU6M.js","assets/ChapterList-CAEK7Fim.js","assets/dnd.esm-sGhUNbpo.js","assets/Collapse-D57cS8Q2.js","assets/index-A8UrXWNV.js","assets/useClosable-BMlLLbW6.js","assets/pencil-BHIqPcQ5.js","assets/index-C1pdE3N8.js","assets/ActionButton-DZkZ4UyV.js","assets/trash-2-AcrYeN4V.js","assets/ChapterModals-Dqf9JEel.js","assets/katex-_9UfHwjh.js","assets/katex-Jy9P_KAo.css","assets/index-CWRbA1GH.js","assets/context-Co2t6AGx.js","assets/useMergedMask-hWGqm8nf.js","assets/index-Dixg4MZV.js","assets/file-text-Z3y9FrNB.js","assets/index-DKe4wx0O.js","assets/DeleteOutlined-B97TiFIe.js","assets/progress-BgTHiS06.js","assets/upload-VxSW6h0e.js"])))=>i.map(i=>d[i]);
import{m as a}from"./charts-4CCI6hAs.js";import{e6 as e,e2 as t,ba as s,F as r,e7 as n,e8 as l,e9 as i,ea as d,eb as u,ec as o,o as c,aL as m,s as p,a0 as _,z as h}from"./index-DJgzJvx0.js";import{r as b}from"./vendor-kOq7Q5-U.js";const g=b.lazy(()=>a(()=>import("./LearningHeader-piOYd0yl.js"),__vite__mapDeps([0,1,2,3,4,5]))),y=b.lazy(()=>a(()=>import("./LearningFilters-CerB-3YM.js"),__vite__mapDeps([6,1,2,3,4,7,8,9]))),C=b.lazy(()=>a(()=>import("./ChapterList-CAEK7Fim.js").then(a=>a.C),__vite__mapDeps([10,3,2,1,4,11,9,12,13,14,5,15,16,17,18]))),j=b.lazy(()=>a(()=>import("./ChapterModals-Dqf9JEel.js"),__vite__mapDeps([19,1,2,3,4,20,21,22,17,23,24,14,25,8,9,18,5,26,27,28,29,30]))),f=a=>a?Array.isArray(a)?a.filter(Boolean):"string"==typeof a&&a?[a]:[]:[],w=({subjectId:a,subject:w})=>{const[I,v]=b.useState(null),[x,S]=b.useState(null),{data:E}=e({subjectId:a}),{data:F}=t({subjectId:a,gradeId:I}),{data:O,isLoading:L}=s({subjectId:a,gradeId:I,classId:x}),A=O?.data||[],D=E?.data||[],M=F?.data||[],[P,R]=b.useState([]),[V,k]=b.useState(!1),[z,B]=b.useState(null),[T]=r.useForm(),[G,H]=b.useState(!1),[Q,U]=b.useState(null),[q,J]=b.useState(null),[K]=r.useForm(),[N]=n(),[W]=l(),[X]=i(),[Y]=d(),[Z]=u(),[$]=o(),aa=b.useMemo(()=>D.map(a=>({label:a.name,value:a.id})),[D]),ea=b.useMemo(()=>M.map(a=>({label:a.name,value:a.id})),[M]),ta=b.useMemo(()=>{const a=[...A];return a.sort((a,e)=>{const t=a.order_number??9999,s=e.order_number??9999;return t!==s?t-s:a.title.localeCompare(e.title)}),a},[A]);b.useEffect(()=>{R(ta)},[ta]);const sa=a=>{B(a||null),T.resetFields(),a&&T.setFieldsValue({title:a.title,description:a.description,order_number:a.order_number,grade_id:a.grade_id||null,class_ids:a.class_ids&&a.class_ids.length>0?a.class_ids:a.class_id?[a.class_id]:[]}),k(!0)},ra=(a,e)=>{if(U(a||null),J(e),K.resetFields(),a){const e=f(a.video_urls).length?f(a.video_urls):f(a.video_url),t=f(a.attachment_urls).length?f(a.attachment_urls):f(a.attachment_url),s=f(a.attachment_names).length?f(a.attachment_names):f(a.attachment_name),r=t.map((a,e)=>({url:a,name:s[e]||null}));K.setFieldsValue({title:a.title,body:a.body,video_urls:e,attachments:r})}H(!0)};return c.jsx(b.Suspense,{fallback:c.jsx(p,{style:{borderRadius:12},children:c.jsx(_,{active:!0,paragraph:{rows:4}})}),children:c.jsxs(m,{vertical:!0,gap:16,children:[c.jsx(g,{subject:w,onAddChapter:sa}),c.jsx(y,{gradeOptions:aa,classOptions:ea,filterGradeId:I,filterClassId:x,onGradeChange:a=>{v(a||null),S(null)},onClassChange:a=>S(a||null)}),c.jsx(C,{isLoading:L,chapterItems:P,onChapterDragEnd:async a=>{if(!a.destination)return;if(a.destination.index===a.source.index)return;const e=[...P],[t]=e.splice(a.source.index,1);e.splice(a.destination.index,0,t),R(e);try{await Promise.all(e.map((a,e)=>W({id:a.id,title:a.title,description:a.description,order_number:e+1,grade_id:a.grade_id,class_id:a.class_id}).unwrap())),h.success("Urutan bab diperbarui.")}catch(s){h.error("Gagal mengubah urutan bab.")}},onAddContent:ra,onEditChapter:sa,onDeleteChapter:async a=>{try{await X(a).unwrap(),h.success("Bab dihapus.")}catch(e){e?.data?.message&&h.error(e.data.message)}},onEditContent:ra,onDeleteContent:async a=>{try{await $(a).unwrap(),h.success("Subbab dihapus.")}catch(e){e?.data?.message&&h.error(e.data.message)}}}),c.jsx(j,{chapterModalOpen:V,editingChapter:z,onCancelChapter:()=>{k(!1),B(null)},onOkChapter:async()=>{try{const e=await T.validateFields(),t={...e,class_ids:e.class_ids||[]};z?.id?(await W({id:z.id,...t}).unwrap(),h.success("Bab diperbarui.")):(await N({subjectId:a,...t}).unwrap(),h.success("Bab ditambahkan.")),k(!1),B(null)}catch(e){e?.data?.message&&h.error(e.data.message)}},chapterForm:T,gradeOptions:aa,classOptions:ea,contentModalOpen:G,editingContent:Q,onCancelContent:()=>{H(!1),U(null),J(null)},onOkContent:async()=>{try{const a=await K.validateFields(),e=(a.video_urls||[]).map(a=>"string"==typeof a?a.trim():"").filter(Boolean),t=(a.attachments||[]).map(a=>({url:"string"==typeof a?.url?a.url.trim():"",name:"string"==typeof a?.name&&a.name.trim()?a.name.trim():null})).filter(a=>a.url),s={title:a.title,body:a.body,order_number:a.order_number,video_urls:e,attachment_urls:t.map(a=>a.url),attachment_names:t.map(a=>a.name),video_url:e[0]||null,attachment_url:t[0]?.url||null,attachment_name:t[0]?.name||null};Q?(await Z({id:Q.id,...s}).unwrap(),h.success("Subbab diperbarui.")):(await Y({chapterId:q,...s}).unwrap(),h.success("Subbab ditambahkan.")),H(!1),U(null),J(null)}catch(a){a?.data?.message&&h.error(a.data.message)}},contentForm:K})]})})};export{w as default};
