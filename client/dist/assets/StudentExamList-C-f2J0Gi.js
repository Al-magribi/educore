import{aR as e,T as a,F as n,cc as s,o as t,Y as i,y as r,B as l,D as o,k as c,cd as d,s as m,x as u,C as j,w as h,a1 as x}from"./index-IfHJv5WL.js";import{I as p,r as f}from"./vendor-kOq7Q5-U.js";import{M as y}from"./index-CQKi3m8Y.js";import{A as k}from"./index-Ck6zxCm-.js";import{B as g}from"./index-IbKRFMNk.js";import{T as b}from"./index-BM57nN4D.js";import{B as _}from"./book-open-CsjBihp8.js";import{U as w}from"./user-round-C1oGp78w.js";import{T as S}from"./timer-DTUBm49M.js";import{E as v}from"./index-BSxM1sbQ.js";import{C as z}from"./clipboard-list-bPLR920r.js";import{G as M}from"./graduation-cap-D288yEz_.js";import"./charts-DyIopC3t.js";import"./ActionButton-CwPtgC52.js";const T=e("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]),U=e("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]),{Text:C}=a,A=e=>"pelanggaran"===e?{type:"error",title:"Status: Pelanggaran"}:"mengerjakan"===e?{type:"warning",title:"Status: Mengerjakan"}:"selesai"===e?{type:"info",title:"Status: Selesai"}:null,B=async(e,a=2500)=>{const n=new AbortController,s=setTimeout(()=>n.abort(),a);try{const a=await fetch(e,{signal:n.signal,cache:"no-store"});if(!a.ok)return null;const s=await a.json(),t=s?.ip||s?.ip_addr||s?.address;return"string"==typeof t&&t.trim()?t.trim():null}catch(t){return null}finally{clearTimeout(s)}},F=async()=>{if("undefined"==typeof window||"function"!=typeof fetch)return null;const e=["https://api64.ipify.org?format=json","https://api.ipify.org?format=json","https://ifconfig.me/all.json"];for(const a of e){const e=await B(a);if(e)return e}return null},q=({open:e,onClose:a,exam:c})=>{const[d]=n.useForm(),m=p(),[u,{isLoading:j}]=s(),[h,x]=f.useState(null),[g,b]=f.useState(null);f.useEffect(()=>{e&&(d.resetFields(),x(null),b(null),F().then(e=>b(e)))},[e,d]);return t.jsx(y,{title:t.jsxs(i,{align:"center",size:8,children:[t.jsx(U,{size:18}),t.jsx("span",{children:"Masukkan Token Ujian"})]}),open:e,onCancel:a,footer:null,centered:!0,destroyOnHidden:!0,children:t.jsxs(i,{vertical:!0,size:12,style:{width:"100%"},children:[t.jsx(C,{type:"secondary",children:c?.name?`Ujian: ${c.name}`:"Pastikan token sesuai jadwal."}),h&&A(h.status)&&t.jsx(k,{type:A(h.status).type,title:A(h.status).title,description:h.message,showIcon:!0}),t.jsxs(n,{form:d,layout:"vertical",onFinish:async e=>{try{x(null);const n=g||await F();await u({exam_id:c?.id,token:e.token?.trim(),student_ip:n||void 0}).unwrap(),await(async()=>{if("undefined"==typeof document)return!1;if(document.fullscreenElement)return!0;const e=document.documentElement;if(!e?.requestFullscreen)return!1;try{return await e.requestFullscreen(),!0}catch(a){return!1}})(),o.success("Token valid. Selamat mengerjakan ujian."),m(`/computer-based-test/start?exam_id=${c?.id}&exam_name=${c?.name?.replaceAll(" ","-")}`),a()}catch(n){const e=n?.data?.status||null,a=n?.data?.message||"Token ujian tidak valid";e?x({status:e,message:a}):o.error(a)}},children:[t.jsx(n.Item,{label:"Token Ujian",name:"token",rules:[{required:!0,message:"Token ujian wajib diisi"}],children:t.jsx(r,{placeholder:"Masukkan token ujian"})}),t.jsx(C,{type:"secondary",style:{fontSize:12},children:"Status ujian: Belum Masuk = belum mengikuti, Pelanggaran = keluar dari halaman ujian, Mengerjakan = masih berlangsung, Selesai = sudah menjawab semua soal."}),t.jsxs(i,{style:{width:"100%",justifyContent:"flex-end"},children:[t.jsx(l,{onClick:a,children:"Batal"}),t.jsx(l,{type:"primary",htmlType:"submit",loading:j,children:"Verifikasi"})]})]})]})})},{Title:E,Text:I}=a,J=()=>{const e=c.c(36),{data:a,isLoading:n,isError:s}=d(),[r,o]=f.useState(null),[p,y]=f.useState(!1),k=a?.length||0;let U;a?.reduce(R,0),e[0]!==a?(U=new Set((a||[]).map($).filter(Boolean)),e[0]=a,e[1]=U):U=e[1];const C=U.size,A=a?.[0]?.class_name||"Kelas belum tersedia";if(n){let a;return e[2]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(h,{title:"Jadwal Ujian",children:t.jsx(m,{children:t.jsx(x,{active:!0,paragraph:{rows:6}})})}),e[2]=a):a=e[2],a}if(s){let a;return e[3]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(h,{title:"Jadwal Ujian",children:t.jsx(m,{children:t.jsx(I,{type:"danger",children:"Gagal memuat jadwal ujian."})})}),e[3]=a):a=e[3],a}let B;e[4]===Symbol.for("react.memo_cache_sentinel")?(B=e=>{o(e),y(!0)},e[4]=B):B=e[4];const F=B;let J;e[5]===Symbol.for("react.memo_cache_sentinel")?(J=()=>{y(!1),o(null)},e[5]=J):J=e[5];const D=J;let H,L,P,V,G,N,K,O,Y,Q,W,X,Z,ee,ae,ne,se;return e[6]===Symbol.for("react.memo_cache_sentinel")?(H={width:"100%"},e[6]=H):H=e[6],e[7]===Symbol.for("react.memo_cache_sentinel")?(L={width:"100%"},e[7]=L):L=e[7],e[8]===Symbol.for("react.memo_cache_sentinel")?(P=t.jsx("div",{style:{width:44,height:44,borderRadius:12,background:"#eef2ff",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(z,{size:20,color:"#4f46e5"})}),e[8]=P):P=e[8],e[9]===Symbol.for("react.memo_cache_sentinel")?(V=t.jsxs(i,{align:"center",size:12,children:[P,t.jsxs("div",{children:[t.jsx(E,{level:4,style:{margin:0},children:"Jadwal Ujian"}),t.jsx(I,{type:"secondary",children:"Daftar ujian aktif sesuai kelas Anda"})]})]}),e[9]=V):V=e[9],e[10]===Symbol.for("react.memo_cache_sentinel")?(G=t.jsx(M,{size:12}),e[10]=G):G=e[10],e[11]!==A?(N=t.jsx(b,{color:"blue",icon:G,children:A}),e[11]=A,e[12]=N):N=e[12],e[13]===Symbol.for("react.memo_cache_sentinel")?(K=t.jsx(_,{size:12}),e[13]=K):K=e[13],e[14]!==C?(O=t.jsxs(b,{color:"geekblue",icon:K,children:[C," Mapel"]}),e[14]=C,e[15]=O):O=e[15],e[16]===Symbol.for("react.memo_cache_sentinel")?(Y=t.jsx(T,{size:12}),e[16]=Y):Y=e[16],e[17]!==k?(Q=t.jsxs(b,{color:"purple",icon:Y,children:[k," Ujian Aktif"]}),e[17]=k,e[18]=Q):Q=e[18],e[19]!==O||e[20]!==Q||e[21]!==N?(W=t.jsx(m,{hoverable:!0,children:t.jsxs(i,{vertical:!0,size:10,style:L,children:[V,t.jsxs(i,{wrap:!0,size:8,children:[N,O,Q]})]})}),e[19]=O,e[20]=Q,e[21]=N,e[22]=W):W=e[22],e[23]===Symbol.for("react.memo_cache_sentinel")?(X=t.jsxs(i,{align:"center",size:8,children:[t.jsx(z,{size:18,color:"#1d4ed8"}),t.jsx("span",{children:"Daftar Ujian"})]}),Z={borderRadius:16},e[23]=X,e[24]=Z):(X=e[23],Z=e[24]),e[25]!==a?(ee=t.jsx(m,{title:X,style:Z,children:a?.length?t.jsx(u,{gutter:[16,16],children:a.map(e=>t.jsx(j,{xs:24,md:12,xl:8,children:t.jsx(g.Ribbon,{text:e.bank_type||"Ujian",children:t.jsx(m,{hoverable:!0,actions:[t.jsx(l,{type:"primary",onClick:()=>F(e),children:"Ikuti Ujian"})],children:t.jsxs(i,{vertical:!0,size:10,style:{width:"100%"},children:[t.jsxs(i,{align:"center",size:8,children:[t.jsx(I,{strong:!0,children:e.name}),t.jsx(b,{color:"green",children:"Aktif"})]}),t.jsxs(i,{size:12,wrap:!0,children:[t.jsxs(I,{type:"secondary",children:[t.jsx(_,{size:14})," ",e.subject_name||"-"]}),t.jsxs(I,{type:"secondary",children:[t.jsx(w,{size:14})," ",e.teacher_name||"-"]}),t.jsxs(I,{type:"secondary",children:[t.jsx(S,{size:14})," ",e.duration_minutes," menit"]})]})]})})})},e.id))}):t.jsx(v,{description:"Belum ada jadwal ujian untuk kelas Anda."})}),e[25]=a,e[26]=ee):ee=e[26],e[27]!==W||e[28]!==ee?(ae=t.jsxs(i,{vertical:!0,size:20,style:H,children:[W,ee]}),e[27]=W,e[28]=ee,e[29]=ae):ae=e[29],e[30]!==r||e[31]!==p?(ne=t.jsx(q,{open:p,onClose:D,exam:r}),e[30]=r,e[31]=p,e[32]=ne):ne=e[32],e[33]!==ae||e[34]!==ne?(se=t.jsxs(h,{title:"Jadwal Ujian",children:[ae,ne]}),e[33]=ae,e[34]=ne,e[35]=se):se=e[35],se};function R(e,a){return e+Number(a.duration_minutes||0)}function $(e){return e.subject_name}export{J as default};
