import{az as e,k as r,o as t,X as n,w as s,C as a,s as i,T as l,B as o,aL as d,x as c,aF as u,l as x,ax as f,b0 as h,b1 as p,b2 as g,b3 as b,b4 as m,z as j,b5 as y,a0 as w}from"./index-DJgzJvx0.js";import{r as k,T as v,I as S}from"./vendor-kOq7Q5-U.js";import{P as _}from"./progress-BgTHiS06.js";import{C}from"./clipboard-list-DE6PC1DM.js";import{C as z}from"./chevron-down-BfyMiLlt.js";import{L as M}from"./list-checks-CUXdcjSw.js";import{B as T}from"./index-B466D75m.js";import{D as I}from"./index-Ddh-PgSR.js";import{M as R}from"./index-CWRbA1GH.js";import{D as E,C as q,P}from"./dnd.esm-sGhUNbpo.js";import{E as D}from"./index-CsPvpU6M.js";import{G as B}from"./graduation-cap-DX8X8xmD.js";import{T as N}from"./index-A8UrXWNV.js";import{R as W}from"./index-Bjno29EH.js";import{A as L}from"./arrow-left-DYE7YoY3.js";import{B as A}from"./book-open-check-CwaBGfv4.js";import{U as F}from"./user-round-BNUrar0_.js";import"./charts-4CCI6hAs.js";import"./ActionButton-DZkZ4UyV.js";import"./context-Co2t6AGx.js";import"./useMergedMask-hWGqm8nf.js";import"./useClosable-BMlLLbW6.js";const O=e("alarm-clock",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M12 9v4l2 2",key:"1c63tq"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}]]),H=e("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),U=e("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),{Text:$,Title:G}=l,J=e=>{const l=r.c(18),{open:d,onToggle:c,answeredCount:u,doubtCount:x,unansweredCount:f,progressPercent:h,glassCard:p,palette:g}=e;let b,m,j,y,w,k;return l[0]===Symbol.for("react.memo_cache_sentinel")?(b=t.jsxs(n,{children:[t.jsx(C,{size:18}),t.jsx("span",{children:"Progress Jawaban"})]}),l[0]=b):b=l[0],l[1]!==d?(m=d?t.jsx(U,{size:16}):t.jsx(z,{size:16}),l[1]=d,l[2]=m):m=l[2],l[3]!==c||l[4]!==m?(j=t.jsx(o,{type:"text",size:"small",icon:m,onClick:c}),l[3]=c,l[4]=m,l[5]=j):j=l[5],l[6]===Symbol.for("react.memo_cache_sentinel")?(y={body:{padding:"12px 16px"}},l[6]=y):y=l[6],l[7]!==u||l[8]!==x||l[9]!==d||l[10]!==g||l[11]!==h||l[12]!==f?(w=d&&t.jsxs(n,{vertical:!0,size:8,style:{width:"100%"},children:[t.jsxs(s,{gutter:[8,8],children:[t.jsx(a,{span:8,children:t.jsxs(i,{style:{borderRadius:12,background:"rgba(34, 197, 94, 0.12)"},styles:{body:{padding:10}},children:[t.jsx($,{style:{color:g.subtle},children:"Terjawab"}),t.jsx(G,{level:4,style:{margin:0},children:u})]})}),t.jsx(a,{span:8,children:t.jsxs(i,{style:{borderRadius:12,background:"rgba(245, 158, 11, 0.14)"},styles:{body:{padding:10}},children:[t.jsx($,{style:{color:g.subtle},children:"Ragu"}),t.jsx(G,{level:4,style:{margin:0},children:x})]})}),t.jsx(a,{span:8,children:t.jsxs(i,{style:{borderRadius:12,background:"rgba(148, 163, 184, 0.16)"},styles:{body:{padding:10}},children:[t.jsx($,{style:{color:g.subtle},children:"Belum"}),t.jsx(G,{level:5,style:{margin:0},children:f})]})})]}),t.jsx(_,{percent:h,strokeColor:{"0%":g.brand,"100%":g.accent},railColor:"#eaf0fa",showInfo:!1})]}),l[7]=u,l[8]=x,l[9]=d,l[10]=g,l[11]=h,l[12]=f,l[13]=w):w=l[13],l[14]!==p||l[15]!==j||l[16]!==w?(k=t.jsx(i,{title:b,extra:j,style:p,styles:y,children:w}),l[14]=p,l[15]=j,l[16]=w,l[17]=k):k=l[17],k},K=(e,r)=>r?{border:"1px solid #2563eb",background:"rgba(37,99,235,0.1)",color:"#1d4ed8",boxShadow:"0 10px 18px rgba(37,99,235,0.18)"}:"terjawab"===e?{border:"1px solid #22c55e",background:"rgba(34,197,94,0.12)",color:"#166534",boxShadow:"none"}:"ragu"===e?{border:"1px solid #f59e0b",background:"rgba(245,158,11,0.12)",color:"#92400e",boxShadow:"none"}:{border:"1px solid #94a3b8",background:"rgba(148,163,184,0.12)",color:"#475569",boxShadow:"none"},V=e=>{const n=r.c(12),{questionMap:s,currentIndex:a,onSelect:i,columns:l}=e,d=`repeat(${void 0===l?5:l}, minmax(0, 1fr))`;let c,u,x;if(n[0]!==d?(c={display:"grid",gridTemplateColumns:d,gap:8},n[0]=d,n[1]=c):c=n[1],n[2]!==a||n[3]!==i||n[4]!==s){let e;n[6]!==a||n[7]!==i?(e=(e,r)=>{const n=r===a;return t.jsxs("div",{style:{position:"relative",width:"100%"},children:[n&&t.jsx("span",{style:{position:"absolute",top:-2,right:4,width:8,height:8,borderRadius:"50%",background:"#2563eb",boxShadow:"0 0 0 3px rgba(37,99,235,0.15)"}}),t.jsx(o,{size:"small",type:n?"primary":"default",onClick:()=>i(r),style:{width:"100%",borderRadius:999,height:32,paddingInline:0,fontWeight:600,outline:"none",...K(e.status,n)},children:e.number})]},e.id||e.number)},n[6]=a,n[7]=i,n[8]=e):e=n[8],u=s.map(e),n[2]=a,n[3]=i,n[4]=s,n[5]=u}else u=n[5];return n[9]!==c||n[10]!==u?(x=t.jsx("div",{style:c,children:u}),n[9]=c,n[10]=u,n[11]=x):x=n[11],x},Q=e=>{const s=r.c(15),{open:a,onToggle:l,questionMap:d,currentIndex:c,onSelect:u,glassCard:x}=e;let f,h,p,g,b;return s[0]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsxs(n,{children:[t.jsx(M,{size:18}),t.jsx("span",{children:"Daftar Soal"})]}),s[0]=f):f=s[0],s[1]!==a?(h=a?t.jsx(U,{size:16}):t.jsx(z,{size:16}),s[1]=a,s[2]=h):h=s[2],s[3]!==l||s[4]!==h?(p=t.jsx(o,{type:"text",size:"small",icon:h,onClick:l}),s[3]=l,s[4]=h,s[5]=p):p=s[5],s[6]!==c||s[7]!==u||s[8]!==a||s[9]!==d?(g=a&&t.jsxs(n,{vertical:!0,size:8,style:{width:"100%"},children:[t.jsxs(n,{size:8,children:[t.jsx(T,{color:"#22c55e",text:"Terjawab"}),t.jsx(T,{color:"#f59e0b",text:"Ragu"}),t.jsx(T,{color:"#94a3b8",text:"Belum"}),t.jsx(T,{color:"#2563eb",text:"Aktif"})]}),t.jsx(I,{style:{margin:"8px 0"}}),t.jsx(V,{questionMap:d,currentIndex:c,onSelect:u})]}),s[6]=c,s[7]=u,s[8]=a,s[9]=d,s[10]=g):g=s[10],s[11]!==x||s[12]!==p||s[13]!==g?(b=t.jsx(i,{title:f,extra:p,style:x,children:g}),s[11]=x,s[12]=p,s[13]=g,s[14]=b):b=s[14],b},X=e=>{const s=r.c(13),{open:a,onClose:i,questionMap:l,currentIndex:o,onSelect:d}=e;let c,u,x,f,h,p,g;return s[0]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsxs(n,{children:[t.jsx(M,{size:18}),t.jsx("span",{children:"Daftar Soal"})]}),s[0]=c):c=s[0],s[1]===Symbol.for("react.memo_cache_sentinel")?(u={body:{paddingTop:8}},s[1]=u):u=s[1],s[2]===Symbol.for("react.memo_cache_sentinel")?(x={width:"100%"},s[2]=x):x=s[2],s[3]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsxs(n,{size:8,children:[t.jsx(T,{color:"#22c55e",text:"Terjawab"}),t.jsx(T,{color:"#f59e0b",text:"Ragu"}),t.jsx(T,{color:"#94a3b8",text:"Belum"})]}),s[3]=f):f=s[3],s[4]===Symbol.for("react.memo_cache_sentinel")?(h=t.jsx(I,{style:{margin:"8px 0"}}),s[4]=h):h=s[4],s[5]!==o||s[6]!==d||s[7]!==l?(p=t.jsxs(n,{vertical:!0,size:8,style:x,children:[f,h,t.jsx(V,{questionMap:l,currentIndex:o,onSelect:d,columns:5})]}),s[5]=o,s[6]=d,s[7]=l,s[8]=p):p=s[8],s[9]!==i||s[10]!==a||s[11]!==p?(g=t.jsx(R,{title:c,open:a,onCancel:i,footer:null,width:360,styles:u,children:p}),s[9]=i,s[10]=a,s[11]=p,s[12]=g):g=s[12],g},{Title:Y,Text:Z}=l,ee={1:{label:"PG Tunggal",color:"blue"},2:{label:"PG Multi",color:"cyan"},3:{label:"Essay Uraian",color:"purple"},4:{label:"Essay Singkat",color:"geekblue"},5:{label:"Benar / Salah",color:"orange"},6:{label:"Mencocokkan",color:"magenta"}},re=e=>Object.entries(e).filter(([,e])=>Boolean(e)).map(([e,r])=>({leftId:Number.isNaN(Number(e))?e:Number(e),rightId:Number.isNaN(Number(r))?r:Number(r)})),te=({question:e,totalQuestions:r,index:s,isSmallScreen:a,onOpenList:l,answerValue:x,onAnswerChange:f,palette:h})=>{const[p,g]=k.useState([]),[b,m]=k.useState([]),[j,y]=k.useState({}),w=k.useRef(null);if(!e)return t.jsx(i,{style:{borderRadius:16},children:t.jsx(D,{description:"Soal belum tersedia"})});const v=2===e.q_type,S=3===e.q_type,_=4===e.q_type,C=6===e.q_type,z=S||_,T=e.options||[],I=(R=e.q_type,ee[R]||{label:"Unknown",color:"default"});var R;const L=k.useMemo(()=>T.map(e=>({id:String(e.id),label:e.label||""})),[T]),A=k.useMemo(()=>{const e=new Map;return p.forEach(r=>e.set(r.id,r)),e},[p]);k.useEffect(()=>{if(!C)return;const r=e.options||[],t=(n=x)?Array.isArray(n)?n.reduce((e,r)=>{const t=r?.leftId??r?.left_id??r?.left,n=r?.rightId??r?.right_id??r?.right;return t&&n&&(e[String(t)]=String(n)),e},{}):"object"==typeof n?Object.entries(n).reduce((e,[r,t])=>(r&&t&&(e[String(r)]=String(t)),e),{}):{}:{};var n;const s=Object.keys(t).length===Object.keys(j).length&&Object.entries(t).every(([e,r])=>j[e]===r),a=e.id!==w.current||0===p.length;if(!a&&s)return;const i=(Array.isArray(e.right_options)&&e.right_options.length>0?e.right_options:(e=>{if(!Array.isArray(e))return[];const r=[...e];for(let t=r.length-1;t>0;t-=1){const e=Math.floor(Math.random()*(t+1));[r[t],r[e]]=[r[e],r[t]]}return r})(r)).map(e=>({id:String(e.id),content:e.content||""})),l=a?i:p,o=new Set(Object.values(t).map(e=>String(e)));y(t),m(l.filter(e=>!o.has(e.id))),a&&(w.current=e.id,g(i))},[C,e,x,j,p.length]);return t.jsxs(n,{vertical:!0,size:18,style:{width:"100%"},children:[t.jsxs(n,{vertical:!0,size:a?10:12,style:{width:"100%"},children:[t.jsxs(d,{align:a?"flex-start":"center",justify:"space-between",gap:8,wrap:!0,children:[t.jsxs(d,{align:"center",gap:12,style:{minWidth:0,flex:a?1:"initial"},children:[t.jsx("div",{style:{width:40,height:40,borderRadius:12,display:"grid",placeItems:"center",background:"linear-gradient(145deg, #1f5eff 0%, #60a5fa 100%)",color:"#fff"},children:t.jsx(B,{size:18})}),t.jsxs("div",{style:{minWidth:0},children:[t.jsxs(Z,{style:{color:h.subtle,fontSize:12},children:["Pertanyaan ",s+1]}),t.jsx(Y,{level:4,style:{margin:0,fontSize:a?16:void 0,lineHeight:1.2},children:e.title||"Pertanyaan"})]})]}),t.jsxs(N,{color:"default",style:{whiteSpace:"nowrap",marginInlineEnd:0},children:[s+1," dari ",r]})]}),t.jsxs(d,{align:"center",justify:"space-between",gap:8,wrap:!0,style:{width:"100%"},children:[a&&t.jsx(o,{size:"small",icon:t.jsx(M,{size:16}),onClick:l,children:"Daftar Soal"}),t.jsx(N,{color:I.color,style:{whiteSpace:"nowrap",marginInlineStart:"auto"},children:I.label})]})]}),t.jsx(i,{style:{background:"#fbfcff",borderRadius:16,borderColor:"#e7eef8"},styles:{body:{padding:a?14:24}},children:t.jsx("div",{style:{fontSize:a?15:16,color:h.ink,overflowWrap:"anywhere",wordBreak:"break-word"},dangerouslySetInnerHTML:{__html:e.content||""}})}),z?t.jsx(c.TextArea,{value:x||"",onChange:e=>f(e.target.value),rows:S?5:3,placeholder:"Tulis jawaban di sini"}):C?t.jsx(E,{onDragEnd:e=>{if(!e.destination)return;const{source:r,destination:t,draggableId:n}=e,s=n.replace("match-",""),a=r.droppableId,i=t.droppableId,l={...j};let o=[...b];const d=(e,r)=>{const t=A.get(e);t&&(o.some(r=>r.id===e)||("number"==typeof r?o.splice(r,0,t):o.push(t)))};if("right-pool"===i){if("right-pool"===a){const e=[...o],[n]=e.splice(r.index,1);e.splice(t.index,0,n),o=e}else if(a.startsWith("left-")){const e=a.replace("left-","");delete l[e],d(s,t.index)}return y(l),m(o),void("function"==typeof f&&f(re(l)))}if(i.startsWith("left-")){const e=i.replace("left-",""),r=(c=s,Object.keys(l).find(e=>l[e]===c));r&&r!==e&&delete l[r];const t=l[e];if(t&&t!==s&&d(t),l[e]=s,o=o.filter(e=>e.id!==s),a.startsWith("left-")){const r=a.replace("left-","");r!==e&&delete l[r]}y(l),m(o),"function"==typeof f&&f(re(l))}var c},children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:a?"1fr":"1.25fr 1fr",gap:16},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[t.jsx(Z,{type:"secondary",style:{fontWeight:600},children:"Premis"}),L.map((e,r)=>{const s=j[e.id],a=s?A.get(s):null;return t.jsx(i,{styles:{body:{padding:"12px 16px"}},style:{borderRadius:14,borderColor:"#e7eef8",background:"#fff"},children:t.jsxs(n,{orientation:"vertical",size:10,style:{width:"100%"},children:[t.jsxs(n,{align:"start",children:[t.jsx(N,{color:"blue",style:{minWidth:32},children:String.fromCharCode(65+r)}),t.jsx("div",{style:{color:h.subtle,overflowWrap:"anywhere",wordBreak:"break-word"},dangerouslySetInnerHTML:{__html:e.label||"-"}})]}),t.jsx(q,{droppableId:`left-${e.id}`,children:(e,r)=>t.jsxs("div",{ref:e.innerRef,...e.droppableProps,style:{minHeight:44,borderRadius:12,border:"1px dashed "+(r.isDraggingOver?"#1f5eff":"#d8e4f8"),background:r.isDraggingOver?"rgba(31, 94, 255, 0.06)":"#f8fbff",padding:"8px 12px",display:"flex",alignItems:"center"},children:[a?t.jsx(P,{draggableId:`match-${a.id}`,index:0,children:(e,r)=>t.jsx("div",{ref:e.innerRef,...e.draggableProps,...e.dragHandleProps,style:{width:"100%",background:"#ffffff",borderRadius:10,border:"1px solid #e7eef8",padding:"6px 10px",boxShadow:r.isDragging?"0 8px 16px rgba(15, 23, 42, 0.12)":"none",...e.draggableProps.style},children:t.jsx("div",{style:{color:h.ink,overflowWrap:"anywhere",wordBreak:"break-word"},dangerouslySetInnerHTML:{__html:a.content||""}})})}):t.jsx(Z,{type:"secondary",children:"Tarik jawaban ke sini"}),e.placeholder]})})]})},e.id)})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[t.jsx(Z,{type:"secondary",style:{fontWeight:600},children:"Daftar Jawaban"}),t.jsx(q,{droppableId:"right-pool",children:e=>t.jsxs("div",{ref:e.innerRef,...e.droppableProps,style:{display:"flex",flexDirection:"column",gap:10},children:[b.map((e,r)=>t.jsx(P,{draggableId:`match-${e.id}`,index:r,children:(r,n)=>t.jsx(i,{ref:r.innerRef,...r.draggableProps,...r.dragHandleProps,styles:{body:{padding:"10px 14px"}},style:{borderRadius:12,borderColor:"#e7eef8",background:"#ffffff",boxShadow:n.isDragging?"0 10px 18px rgba(15, 23, 42, 0.15)":"none",...r.draggableProps.style},children:t.jsx("div",{style:{color:h.ink,overflowWrap:"anywhere",wordBreak:"break-word"},dangerouslySetInnerHTML:{__html:e.content||""}})})},e.id)),e.placeholder]})})]})]})}):v?t.jsx(u.Group,{style:{width:"100%"},value:x||[],onChange:f,children:t.jsx(n,{vertical:!0,size:12,style:{width:"100%"},children:T.map((e,r)=>t.jsx(i,{styles:{body:{padding:"12px 16px"}},style:{borderRadius:14,cursor:"pointer",borderColor:"#e7eef8",background:"linear-gradient(135deg, #ffffff 0%, #f8fbff 100%)"},children:t.jsx(u,{value:e.id,style:{width:"100%"},children:t.jsxs(n,{align:"start",style:{width:"100%"},children:[t.jsx(N,{color:"blue",style:{minWidth:32},children:e.label||String.fromCharCode(65+r)}),t.jsx("div",{style:{color:h.subtle,flex:1,minWidth:0,overflowWrap:"anywhere",wordBreak:"break-word"},dangerouslySetInnerHTML:{__html:e.content||""}})]})})},e.id||e.label||r))})}):t.jsx(W.Group,{style:{width:"100%"},value:x||null,onChange:e=>f(e.target.value),children:t.jsx(n,{vertical:!0,size:12,style:{width:"100%"},children:T.map((e,r)=>t.jsx(i,{styles:{body:{padding:"12px 16px"}},style:{borderRadius:14,cursor:"pointer",borderColor:"#e7eef8",background:"linear-gradient(135deg, #ffffff 0%, #f8fbff 100%)"},children:t.jsx(W,{value:e.id,style:{width:"100%"},children:t.jsxs(n,{align:"start",style:{width:"100%"},children:[t.jsx(N,{color:"blue",style:{minWidth:32},children:e.label||String.fromCharCode(65+r)}),t.jsx("div",{style:{color:h.subtle,flex:1,minWidth:0,overflowWrap:"anywhere",wordBreak:"break-word"},dangerouslySetInnerHTML:{__html:e.content||""}})]})})},e.id||e.label||r))})})]})},ne=e=>{const i=r.c(10),{isSmallScreen:l,onToggleDoubt:d,onPrev:c,onNext:u,canPrev:x,canNext:f,isDoubt:h,showFinish:p,onFinish:g}=e;let b;return i[0]!==f||i[1]!==x||i[2]!==h||i[3]!==l||i[4]!==g||i[5]!==u||i[6]!==c||i[7]!==d||i[8]!==p?(b=l?t.jsxs(s,{gutter:[8,8],children:[t.jsx(a,{span:24,children:t.jsx(o,{block:!0,icon:t.jsx(z,{size:16}),onClick:d,style:h?{background:"#f59e0b",borderColor:"#f59e0b",color:"#fff"}:void 0,children:"Ragu-ragu"})}),t.jsx(a,{span:12,children:t.jsx(o,{block:!0,icon:t.jsx(L,{size:16}),onClick:c,disabled:!x,children:"Sebelumnya"})}),t.jsx(a,{span:12,children:t.jsx(o,{block:!0,type:"primary",icon:t.jsx(H,{size:16}),onClick:u,disabled:!f,children:"Berikutnya"})}),p&&t.jsx(a,{span:24,children:t.jsx(o,{block:!0,type:"primary",danger:!0,onClick:g,children:"Selesai"})})]}):t.jsxs(n,{align:"center",size:12,style:{justifyContent:"space-between",width:"100%"},children:[t.jsx(n,{size:8,children:t.jsx(o,{icon:t.jsx(z,{size:16}),onClick:d,style:h?{background:"#f59e0b",borderColor:"#f59e0b",color:"#fff"}:void 0,children:"Ragu-ragu"})}),t.jsxs(n,{size:8,children:[t.jsx(o,{icon:t.jsx(L,{size:16}),onClick:c,disabled:!x,children:"Soal Sebelumnya"}),t.jsx(o,{type:"primary",icon:t.jsx(H,{size:16}),onClick:u,disabled:!f,children:"Soal Berikutnya"}),p&&t.jsx(o,{type:"primary",danger:!0,onClick:g,children:"Selesai"})]})]}),i[0]=f,i[1]=x,i[2]=h,i[3]=l,i[4]=g,i[5]=u,i[6]=c,i[7]=d,i[8]=p,i[9]=b):b=i[9],b},{Content:se}=y,{Title:ae,Text:ie}=l,{useBreakpoint:le}=f,oe=e=>{const r=Math.max(0,e),t=Math.floor(r/3600),n=Math.floor(r%3600/60),s=r%60,a=e=>String(e).padStart(2,"0");return`${a(t)}:${a(n)}:${a(s)}`},de=()=>"undefined"!=typeof document&&Boolean(document.fullscreenElement),ce=async()=>{if("undefined"!=typeof document&&document.fullscreenElement&&document.exitFullscreen)try{await document.exitFullscreen()}catch(e){}},ue=()=>{const[e]=v(),r=S(),l=x(e=>e.auth?.user),d=!le().md,[c,u]=k.useState(!1),[f,_]=k.useState({progress:!0,daftar:!0}),C=e.get("exam_name"),z=e.get("exam_id"),{data:M,isLoading:T,isError:R,error:E}=h({exam_id:z},{skip:!z}),{data:q}=p({exam_id:z},{skip:!z}),P=M?.exam,B=P?.name?P.name:C?C.replaceAll("-"," "):"Ujian Semester";k.useEffect(()=>{document.title=B},[B]),k.useEffect(()=>{if(!R||!E)return;if(403!==E?.status)return;const e=E?.data?.status;"belum_masuk"!==e&&"selesai"!==e&&"pelanggaran"!==e||r("/siswa/jadwal-ujian")},[R,E,r]);const W=P?.duration_minutes||90,L=P?.session?.start_at,H=P?.session?.end_at,U=P?.session?.remaining_seconds,$=Boolean(l?.id&&P?.id&&L&&!T&&!R),G=k.useMemo(()=>{if(!$)return null;if(Number.isFinite(U))return Math.max(0,Number(U));if(H){const e=new Date(H).getTime();if(!Number.isNaN(e)){const r=Math.round((e-Date.now())/1e3);return Math.max(0,r)}}const e=new Date(L).getTime();if(Number.isNaN(e))return 60*W;const r=e+60*W*1e3,t=Math.round((r-Date.now())/1e3);return Math.max(0,t)},[$,U,H,L,W]),[K,V]=k.useState(null),[Y]=g(),[Z]=b(),[ee]=m(),[re,ue]=k.useState(!1),[xe,fe]=k.useState(!1),[he,pe]=k.useState(""),[ge,be]=k.useState(de()),me=k.useRef(!1),je=k.useRef(!1),ye=k.useRef(!1);k.useEffect(()=>{$&&V(G)},[$,G]),k.useEffect(()=>{if(!$||"number"!=typeof K)return;const e=setInterval(()=>{V(e=>"number"==typeof e?Math.max(0,e-1):e)},1e3);return()=>clearInterval(e)},[$,K]);const we=k.useCallback(async({silent:e=!1}={})=>{if(!z||je.current)return;je.current=!0;let t=!1;try{await Y({exam_id:z}).unwrap(),await ce(),t=!0,e||j.success("Ujian berhasil diselesaikan."),r("/siswa/jadwal-ujian")}catch(n){e||j.error(n?.data?.message||"Gagal menyelesaikan ujian.")}finally{t||(je.current=!1)}},[z,Y,r]);k.useEffect(()=>{$&&(0!==K||re||z&&(ue(!0),we({silent:!0}).finally(()=>{ue(!1)})))},[$,K,re,z,we]);const ke=k.useCallback(async()=>{fe(!0);await(async()=>{if("undefined"==typeof document)return!1;if(document.fullscreenElement)return!0;const e=document.documentElement;if(!e?.requestFullscreen)return!1;try{return await e.requestFullscreen(),!0}catch(r){return!1}})()?(pe(""),be(!0)):pe("Browser menolak mode layar penuh. Klik tombol untuk masuk fullscreen sebelum melanjutkan ujian."),fe(!1)},[]),ve=k.useCallback(async e=>{if(z&&!me.current&&!je.current){me.current=!0;try{await Z({exam_id:z,reason:e}).unwrap()}catch(t){}finally{await ce(),j.error("Pelanggaran terdeteksi. Anda dikeluarkan dari ujian dan harus meminta izin pengawas."),r("/siswa/jadwal-ujian")}}},[z,Z,r]);k.useEffect(()=>{$&&(be(de()),ye.current||(ye.current=!0,ke()))},[$,ke]),k.useEffect(()=>{if(!$||!z)return;const e=()=>{const e=de();be(e),e||ve("exit_fullscreen")},r=()=>{document.hidden&&ve("switch_tab")},t=()=>{document.hidden||ve("window_blur")},n=new Set(["tab","t","w","n","r"]),s=e=>{const r=String(e.key||""),t=r.toLowerCase(),s="Tab"===r&&e.altKey,a=e.ctrlKey&&n.has(t);(s||a||("F11"===r||"F12"===r||"Escape"===r))&&e.preventDefault()};return document.addEventListener("fullscreenchange",e),document.addEventListener("visibilitychange",r),window.addEventListener("blur",t),window.addEventListener("keydown",s,!0),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("visibilitychange",r),window.removeEventListener("blur",t),window.removeEventListener("keydown",s,!0)}},[z,$,ve]);const Se=M?.questions||[],_e=Se.length,[Ce,ze]=k.useState(0),[Me,Te]=k.useState({}),[Ie,Re]=k.useState({}),Ee=k.useRef(!1),qe=k.useRef({});k.useEffect(()=>{ze(0)},[_e]),k.useEffect(()=>{Te({}),Re({}),Ee.current=!1,me.current=!1,je.current=!1,ye.current=!1,pe("")},[z]),k.useEffect(()=>{if(!Array.isArray(q)||Ee.current)return;const e={},r={};q.forEach(t=>{null!=t?.answer_json&&(e[t.question_id]=t.answer_json),t?.is_doubt&&(r[t.question_id]=!0)}),Te(e),Re(r),Ee.current=!0},[q]),k.useEffect(()=>()=>{Object.values(qe.current).forEach(e=>clearTimeout(e))},[]);const Pe=e=>{if(Ie[e])return"ragu";const r=Me[e];return(Array.isArray(r)?r.length>0:r)?"terjawab":"belum"},De=k.useMemo(()=>Se.map((e,r)=>({id:e.id,number:r+1,status:Pe(e.id)})),[Se,Me,Ie]),Be=De.filter(e=>"terjawab"===e.status).length,Ne=De.filter(e=>"ragu"===e.status).length,We=_e-Be-Ne,Le=_e>0?Math.round(Be/_e*100):0,Ae={ink:"#0b1b3f",subtle:"#5b6b8a",surface:"#ffffff",border:"#e6edf7",brand:"#1f5eff",accent:"#14b8a6",warm:"#f59e0b",cool:"#0ea5e9"},Fe={borderRadius:16,border:`1px solid ${Ae.border}`,boxShadow:"0 18px 40px rgba(15, 23, 42, 0.08)",background:"linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,255,0.92) 100%)"},Oe=e=>{_(r=>({...r,[e]:!r[e]}))},He=Se[Ce],Ue=Ce>0,$e=Ce<_e-1,Ge=!!He&&Boolean(Ie[He.id]),Je=_e>0&&Be===_e,Ke=e=>{ze(e),d&&u(!1)};return t.jsxs(y,{style:{minHeight:"100vh",background:"radial-gradient(circle at 10% 10%, rgba(30, 94, 255, 0.16), transparent 45%), radial-gradient(circle at 90% 0%, rgba(20, 184, 166, 0.18), transparent 40%), linear-gradient(160deg, #f6f8ff 0%, #f9fbff 50%, #ffffff 100%)"},children:[t.jsx(se,{style:{padding:d?"16px 14px 32px":"24px 28px 48px"},children:t.jsxs(n,{vertical:!0,size:18,style:{width:"100%"},children:[t.jsx(i,{style:{...Fe,background:"linear-gradient(130deg, rgba(31,94,255,0.12) 0%, rgba(14,165,233,0.08) 55%, rgba(255,255,255,0.96) 100%)"},children:t.jsxs(s,{gutter:[16,16],align:"middle",children:[t.jsx(a,{xs:24,lg:8,children:t.jsxs(n,{align:"center",size:12,children:[t.jsx("div",{style:{width:46,height:46,borderRadius:14,display:"grid",placeItems:"center",background:"linear-gradient(145deg, #1f5eff 0%, #5aa0ff 100%)",color:"#fff",boxShadow:"0 10px 24px rgba(31,94,255,0.35)"},children:t.jsx(A,{size:22})}),t.jsxs("div",{children:[t.jsx(ie,{style:{color:Ae.subtle,fontSize:12,letterSpacing:.4,textTransform:"uppercase"},children:"Ujian Aktif"}),t.jsx(ae,{level:4,style:{margin:0,color:Ae.ink},children:B}),t.jsxs(ie,{style:{color:Ae.subtle},children:[P?.subject_name||"Mata Pelajaran"," - ID"," ",P?.id||z||"-"]})]})]})}),t.jsx(a,{xs:24,lg:10,children:t.jsxs(n,{align:"center",size:12,children:[t.jsx("div",{style:{width:46,height:46,borderRadius:14,display:"grid",placeItems:"center",background:"linear-gradient(145deg, #0ea5e9 0%, #38bdf8 100%)",color:"#fff",boxShadow:"0 10px 24px rgba(14,165,233,0.3)"},children:t.jsx(F,{size:20})}),t.jsxs("div",{children:[t.jsx(ie,{style:{color:Ae.subtle,fontSize:12,letterSpacing:.4,textTransform:"uppercase"},children:"Peserta"}),t.jsx(ae,{level:5,style:{margin:0,color:Ae.ink},children:l?.full_name||"-"}),t.jsxs(n,{size:8,wrap:!0,children:[t.jsx(N,{color:"blue",children:l?.nis||"-"}),t.jsx(N,{color:"green",children:l?.class_name||"-"}),t.jsx(N,{color:"cyan",children:"Mengerjakan"})]})]})]})}),t.jsx(a,{xs:24,lg:6,children:t.jsx(i,{style:{borderRadius:14,background:"linear-gradient(140deg, rgba(245,249,255,0.9) 0%, rgba(255,255,255,0.95) 100%)",boxShadow:"0 12px 30px rgba(15, 23, 42, 0.08)"},styles:{body:{padding:14}},children:t.jsxs(n,{align:"center",size:12,children:[t.jsx("div",{style:{width:40,height:40,borderRadius:12,display:"grid",placeItems:"center",background:"linear-gradient(145deg, #f59e0b 0%, #fbbf24 100%)",color:"#fff"},children:t.jsx(O,{size:18})}),t.jsxs("div",{children:[t.jsx(ie,{style:{color:Ae.subtle,fontSize:12,textTransform:"uppercase",letterSpacing:.3},children:"Sisa Waktu"}),t.jsx(ae,{level:4,style:{margin:0,color:Ae.ink},children:"number"==typeof K?oe(K):"--:--:--"})]})]})})})]})}),t.jsxs(s,{gutter:[16,16],children:[t.jsx(a,{xs:24,xl:6,children:t.jsxs(n,{orientation:"vertical",size:12,style:{width:"100%"},children:[t.jsx(J,{open:f.progress,onToggle:()=>Oe("progress"),answeredCount:Be,doubtCount:Ne,unansweredCount:We,progressPercent:Le,glassCard:Fe,palette:Ae}),!d&&t.jsx(Q,{open:f.daftar,onToggle:()=>Oe("daftar"),questionMap:De,currentIndex:Ce,onSelect:Ke,glassCard:Fe})]})}),t.jsx(a,{xs:24,xl:18,children:t.jsx(i,{style:Fe,children:T?t.jsx(w,{active:!0,paragraph:{rows:6}}):R?t.jsx(D,{description:"Gagal memuat soal"}):t.jsxs(n,{vertical:!0,size:18,style:{width:"100%"},children:[t.jsx(te,{question:He,totalQuestions:_e,index:Ce,isSmallScreen:d,onOpenList:()=>u(!0),answerValue:Me[He?.id],onAnswerChange:e=>{if(!He)return;const r=He.id;if(Te(t=>({...t,[r]:e})),!z)return;3===He.q_type||4===He.q_type?(qe.current[r]&&clearTimeout(qe.current[r]),qe.current[r]=setTimeout(()=>{ee({exam_id:z,question_id:r,answer:e})},500)):ee({exam_id:z,question_id:r,answer:e})},palette:Ae}),t.jsx(I,{style:{margin:"4px 0"}}),t.jsx(ne,{isSmallScreen:d,onToggleDoubt:()=>{if(!He)return;const e=!Ie[He.id];Re(r=>({...r,[He.id]:e})),z&&ee({exam_id:z,question_id:He.id,is_doubt:e})},onPrev:()=>ze(e=>Math.max(0,e-1)),onNext:()=>ze(e=>Math.min(_e-1,e+1)),canPrev:Ue,canNext:$e,isDoubt:Ge,showFinish:Je,onFinish:()=>we()})]})})})]})]})}),$&&!ge&&t.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(7, 16, 38, 0.88)",display:"grid",placeItems:"center",padding:24},children:t.jsx(i,{style:{width:"100%",maxWidth:520,borderRadius:16,border:"1px solid #1f5eff"},children:t.jsxs(n,{direction:"vertical",size:14,style:{width:"100%"},children:[t.jsx(ae,{level:4,style:{margin:0},children:"Mode Ujian Wajib Fullscreen"}),t.jsx(ie,{children:"Ujian dikunci pada mode layar penuh. Jika keluar fullscreen atau berpindah tab, status akan menjadi pelanggaran."}),he?t.jsx(ie,{type:"danger",children:he}):null,t.jsx(o,{type:"primary",size:"large",loading:xe,onClick:ke,children:"Masuk Fullscreen"})]})})}),t.jsx(X,{open:d&&c,onClose:()=>u(!1),questionMap:De,currentIndex:Ce,onSelect:Ke})]})};export{ue as default};
