import{k as e,l as t,e2 as a,ed as s,ee as n,o as l,x as o,T as r,z as i,X as c,aL as d,B as m,s as u}from"./index-DJgzJvx0.js";import{r as h}from"./vendor-kOq7Q5-U.js";import{d as f}from"./dayjs.min-CGX6Te6V.js";import{T as p}from"./index-A8UrXWNV.js";import{S as _}from"./index-ZAZRIL-n.js";import{C as b}from"./clipboard-check-Eo2TgE6U.js";import{C as j}from"./calendar-days-OFdOJC2Q.js";import{D as y}from"./index-C55hmNsY.js";import{U as x}from"./users-DP4QiVnj.js";import{R as S}from"./refresh-ccw-CYu9ftZ8.js";import{C as g}from"./circle-check--2TOZgwe.js";import{A as w}from"./index-D-YBaVh2.js";import{F as v}from"./Table-Bpp4NRb8.js";import"./charts-4CCI6hAs.js";import"./useClosable-BMlLLbW6.js";import"./index-CsPvpU6M.js";import"./index-Bjno29EH.js";import"./index-BzygXUWO.js";const{Title:k,Text:C}=r,I=[{value:"Hadir",label:"Hadir",color:"green"},{value:"Telat",label:"Telat",color:"gold"},{value:"Sakit",label:"Sakit",color:"cyan"},{value:"Izin",label:"Izin",color:"blue"},{value:"Alpa",label:"Alpa",color:"red"}],z=e=>{if(!e)return null;const t=String(e).toLowerCase();return"alpha"===t||"alpa"===t?"Alpa":"telat"===t?"Telat":"hadir"===t?"Hadir":"sakit"===t?"Sakit":"izin"===t?"Izin":e},T=r=>{const C=e.c(115),{subjectId:z,subject:T}=r,{user:K}=t(A),[U,G]=h.useState(null);let W;C[0]===Symbol.for("react.memo_cache_sentinel")?(W=f(),C[0]=W):W=C[0];const[X,q]=h.useState(W),[J,O]=h.useState(""),[Q,V]=h.useState("all");let Z;C[1]===Symbol.for("react.memo_cache_sentinel")?(Z=[],C[1]=Z):Z=C[1];const[ee,te]=h.useState(Z),[ae,se]=h.useState(!1);let ne;C[2]===Symbol.for("react.memo_cache_sentinel")?(ne=[],C[2]=ne):ne=C[2];const le=h.useRef(ne);let oe;C[3]!==z?(oe={subjectId:z,gradeId:null},C[3]=z,C[4]=oe):oe=C[4];const re=!z;let ie;C[5]!==re?(ie={skip:re},C[5]=re,C[6]=ie):ie=C[6];const{data:ce,isLoading:de}=a(oe,ie);let me;C[7]!==ce?.data?(me=ce?.data||[],C[7]=ce?.data,C[8]=me):me=C[8];const ue=me;let he;C[9]!==ue?(he=ue.map(Y),C[9]=ue,C[10]=he):he=C[10];const fe=he;let pe,_e,be;C[11]!==fe||C[12]!==U?(_e=()=>{!U&&fe.length>0&&G(fe[0].value)},pe=[fe,U],C[11]=fe,C[12]=U,C[13]=pe,C[14]=_e):(pe=C[13],_e=C[14]),h.useEffect(_e,pe),C[15]!==X?(be=X?X.format("YYYY-MM-DD"):null,C[15]=X,C[16]=be):be=C[16];const je=be;let ye;C[17]!==je||C[18]!==U||C[19]!==z?(ye={subjectId:z,classId:U,date:je},C[17]=je,C[18]=U,C[19]=z,C[20]=ye):ye=C[20];const xe=!z||!U||!je;let Se;C[21]!==xe?(Se={skip:xe},C[21]=xe,C[22]=Se):Se=C[22];const{data:ge,isFetching:we,refetch:ve}=s(ye,Se);let ke;C[23]!==ge?.data?.students?(ke=ge?.data?.students||[],C[23]=ge?.data?.students,C[24]=ke):ke=C[24];const Ce=ke;let Ie;C[25]!==ge?.data?.meta?(Ie=ge?.data?.meta||{},C[25]=ge?.data?.meta,C[26]=Ie):Ie=C[26];const ze=Ie;let Te,Ae;C[27]!==Ce?(Te=()=>{const e=Ce.map(R);te(e),le.current=e.map(L),se(!1)},Ae=[Ce],C[27]=Ce,C[28]=Te,C[29]=Ae):(Te=C[28],Ae=C[29]),h.useEffect(Te,Ae);const[Ye,Re]=n(),{isLoading:Le}=Re;let Me;if(C[30]!==ee||C[31]!==J||C[32]!==Q){let e;C[34]!==J||C[35]!==Q?(e=e=>{const t="all"===Q||e.status===Q,a=`${e.full_name} ${e.nis} ${e.nisn}`.toLowerCase().includes(J.toLowerCase());return t&&a},C[34]=J,C[35]=Q,C[36]=e):e=C[36],Me=ee.filter(e),C[30]=ee,C[31]=J,C[32]=Q,C[33]=Me}else Me=C[33];const De=Me;let Ne;C[37]!==ee?(Ne=I.reduce(M,{}),ee.forEach(e=>{void 0!==Ne[e.status]&&(Ne[e.status]=Ne[e.status]+1)}),C[37]=ee,C[38]=Ne):Ne=C[38];const Pe=Ne;let Be;C[39]===Symbol.for("react.memo_cache_sentinel")?(Be=(e,t)=>{te(a=>a.map(a=>a.student_id===t.student_id?{...a,status:e}:a)),se(!0)},C[39]=Be):Be=C[39];const Ee=Be;let He;C[40]===Symbol.for("react.memo_cache_sentinel")?(He=e=>{e&&(te(t=>t.map(t=>({...t,status:e}))),se(!0))},C[40]=He):He=C[40];const $e=He;let Fe;C[41]===Symbol.for("react.memo_cache_sentinel")?(Fe=()=>{const e=le.current.map(D);te(e),se(!1)},C[41]=Fe):Fe=C[41];const Ke=Fe;let Ue;C[42]!==je||C[43]!==ve||C[44]!==ee||C[45]!==U||C[46]!==z||C[47]!==Ye||C[48]!==K?.id?(Ue=async()=>{if(!z||!U||!je)return;if(0===ee.length)return void i.warning("Belum ada siswa di kelas ini.");if(ee.find(N))return void i.error("Status kehadiran semua siswa wajib dipilih.");const e=Number(K?.id||0)||null;if(e)try{await Ye({subject_id:z,class_id:U,date:je,teacher_id:e,items:ee.map(t=>({student_id:t.student_id,status:t.status,teacher_id:e}))}).unwrap(),i.success("Absensi berhasil disimpan."),se(!1),ve()}catch(t){const e=t;i.error(e?.data?.message||"Gagal menyimpan absensi.")}else i.error("teacher_id tidak ditemukan. Silakan login ulang.")},C[42]=je,C[43]=ve,C[44]=ee,C[45]=U,C[46]=z,C[47]=Ye,C[48]=K?.id,C[49]=Ue):Ue=C[49];const Ge=Ue;let We,Xe,qe;C[50]===Symbol.for("react.memo_cache_sentinel")?(We={title:"No",dataIndex:"no",width:60,render:P},Xe={title:"Siswa",dataIndex:"full_name",render:B},C[50]=We,C[51]=Xe):(We=C[50],Xe=C[51]),C[52]===Symbol.for("react.memo_cache_sentinel")?(qe=[We,Xe,{title:"Status",dataIndex:"status",width:180,render:(e,t)=>l.jsx(_,{value:t.status,onChange:e=>Ee(e,t),style:{width:"100%"},placeholder:"Pilih Status",options:I.map(E),optionRender:H})}],C[52]=qe):qe=C[52];const Je=qe;let Oe,Qe,Ve,Ze;C[53]===Symbol.for("react.memo_cache_sentinel")?(Oe={borderRadius:16},Qe={body:{padding:20}},C[53]=Oe,C[54]=Qe):(Oe=C[53],Qe=C[54]),C[55]===Symbol.for("react.memo_cache_sentinel")?(Ve={margin:0},C[55]=Ve):Ve=C[55],C[56]===Symbol.for("react.memo_cache_sentinel")?(Ze=l.jsx(k,{level:5,style:Ve,children:l.jsxs(c,{children:[l.jsx(b,{size:18}),"Absensi Kelas"]})}),C[56]=Ze):Ze=C[56];const et=T?.name||ze.subject_name||"Mata Pelajaran";let tt,at,st,nt,lt,ot,rt,it,ct,dt,mt,ut,ht,ft,pt;C[57]!==et?(tt=l.jsxs(c,{wrap:!0,align:"center",children:[Ze,l.jsx(p,{color:"blue",children:et})]}),C[57]=et,C[58]=tt):tt=C[58],C[59]===Symbol.for("react.memo_cache_sentinel")?(at=e=>{G(e),se(!1)},C[59]=at):at=C[59],C[60]===Symbol.for("react.memo_cache_sentinel")?(st={minWidth:200},C[60]=st):st=C[60],C[61]!==de||C[62]!==fe||C[63]!==U?(nt=l.jsx(_,{placeholder:"Pilih kelas",value:U,onChange:at,options:fe,loading:de,style:st}),C[61]=de,C[62]=fe,C[63]=U,C[64]=nt):nt=C[64],C[65]===Symbol.for("react.memo_cache_sentinel")?(lt=e=>q(e),C[65]=lt):lt=C[65],C[66]===Symbol.for("react.memo_cache_sentinel")?(ot=l.jsx(j,{size:16}),C[66]=ot):ot=C[66],C[67]!==X?(rt=l.jsx(y,{value:X,onChange:lt,format:"DD MMM YYYY",allowClear:!1,suffixIcon:ot}),C[67]=X,C[68]=rt):rt=C[68],C[69]===Symbol.for("react.memo_cache_sentinel")?(it=l.jsx(o.Search,{placeholder:"Cari nama / NIS",allowClear:!0,onSearch:e=>O(e),style:{width:220}}),C[69]=it):it=C[69],C[70]===Symbol.for("react.memo_cache_sentinel")?(ct={width:170},dt=[{value:"all",label:"Semua Status"},...I.map($)],C[70]=ct,C[71]=dt):(ct=C[70],dt=C[71]),C[72]!==Q?(mt=l.jsx(_,{value:Q,onChange:V,style:ct,options:dt}),C[72]=Q,C[73]=mt):mt=C[73],C[74]!==nt||C[75]!==rt||C[76]!==mt?(ut=l.jsxs(c,{wrap:!0,children:[nt,rt,it,mt]}),C[74]=nt,C[75]=rt,C[76]=mt,C[77]=ut):ut=C[77],C[78]!==tt||C[79]!==ut?(ht=l.jsxs(d,{justify:"space-between",align:"center",wrap:"wrap",gap:12,children:[tt,ut]}),C[78]=tt,C[79]=ut,C[80]=ht):ht=C[80],C[81]===Symbol.for("react.memo_cache_sentinel")?(ft={marginTop:16},C[81]=ft):ft=C[81],C[82]===Symbol.for("react.memo_cache_sentinel")?(pt=l.jsx(x,{size:12}),C[82]=pt):pt=C[82];const _t=ze.total_students||ee.length;let bt,jt,yt,xt,St;C[83]!==_t?(bt=l.jsxs(p,{color:"blue",icon:pt,children:["Total Siswa: ",_t]}),C[83]=_t,C[84]=bt):bt=C[84],C[85]!==Pe?(jt=I.map(e=>l.jsxs(p,{color:e.color,children:[e.label,": ",Pe[e.value]||0]},e.value)),C[85]=Pe,C[86]=jt):jt=C[86],C[87]!==bt||C[88]!==jt?(yt=l.jsxs(c,{wrap:!0,children:[bt,jt]}),C[87]=bt,C[88]=jt,C[89]=yt):yt=C[89],C[90]===Symbol.for("react.memo_cache_sentinel")?(xt=l.jsx(_,{placeholder:"Set semua status",style:{width:180},options:I.map(F),onChange:$e,allowClear:!0}),C[90]=xt):xt=C[90],C[91]===Symbol.for("react.memo_cache_sentinel")?(St=l.jsx(S,{size:14}),C[91]=St):St=C[91];const gt=!ae;let wt,vt;C[92]!==gt?(wt=l.jsx(m,{icon:St,onClick:Ke,disabled:gt,children:"Reset"}),C[92]=gt,C[93]=wt):wt=C[93],C[94]===Symbol.for("react.memo_cache_sentinel")?(vt=l.jsx(g,{size:14}),C[94]=vt):vt=C[94];const kt=!ae||0===ee.length;let Ct,It,zt,Tt,At,Yt;return C[95]!==Ge||C[96]!==Le||C[97]!==kt?(Ct=l.jsx(m,{type:"primary",icon:vt,onClick:Ge,loading:Le,disabled:kt,children:"Simpan Absensi"}),C[95]=Ge,C[96]=Le,C[97]=kt,C[98]=Ct):Ct=C[98],C[99]!==wt||C[100]!==Ct?(It=l.jsxs(c,{wrap:!0,children:[xt,wt,Ct]}),C[99]=wt,C[100]=Ct,C[101]=It):It=C[101],C[102]!==yt||C[103]!==It?(zt=l.jsxs(d,{justify:"space-between",align:"center",wrap:"wrap",gap:12,style:ft,children:[yt,It]}),C[102]=yt,C[103]=It,C[104]=zt):zt=C[104],C[105]!==ht||C[106]!==zt?(Tt=l.jsxs(u,{style:Oe,styles:Qe,children:[ht,zt]}),C[105]=ht,C[106]=zt,C[107]=Tt):Tt=C[107],C[108]!==De||C[109]!==we||C[110]!==U?(At=U?l.jsx(u,{style:{borderRadius:16},styles:{body:{padding:0}},children:l.jsx(v,{columns:Je,dataSource:De,pagination:!1,loading:we,rowKey:"student_id",scroll:{x:720}})}):l.jsx(w,{type:"info",showIcon:!0,title:"Pilih kelas untuk mulai mengisi absensi."}),C[108]=De,C[109]=we,C[110]=U,C[111]=At):At=C[111],C[112]!==Tt||C[113]!==At?(Yt=l.jsxs(d,{vertical:!0,gap:16,children:[Tt,At]}),C[112]=Tt,C[113]=At,C[114]=Yt):Yt=C[114],Yt};function A(e){return e.auth}function Y(e){return{label:e.name,value:e.id}}function R(e){return{key:e.student_id,student_id:e.student_id,full_name:e.full_name,nis:e.nis,nisn:e.nisn,class_name:e.class_name,status:z(e.status)||void 0}}function L(e){return{...e}}function M(e,t){return e[t.value]=0,e}function D(e){return{...e}}function N(e){return!e.status}function P(e,t,a){return a+1}function B(e,t){return l.jsxs("div",{children:[l.jsx(C,{strong:!0,children:t.full_name}),l.jsxs("div",{style:{color:"#667085",fontSize:12},children:["NIS ",t.nis||"-"]})]})}function E(e){return{value:e.value,label:e.label}}function H(e){const t=I.find(t=>t.value===e.value);return l.jsx(p,{color:t?.color,style:{marginRight:0},children:t?.label})}function $(e){return{value:e.value,label:e.label}}function F(e){return{value:e.value,label:e.label}}export{T as default};
