import{I as e,o as t,X as s,T as a,x as i,ew as r,F as n,w as l,C as o,aL as d,B as m,z as c}from"./index-DJgzJvx0.js";import{r as h,R as p}from"./vendor-kOq7Q5-U.js";import{m as u,R as x,k as j,Q as g,a as b,P as f}from"./katex-_9UfHwjh.js";import{M as v}from"./index-CWRbA1GH.js";import{T as y}from"./index-Dixg4MZV.js";import{S as k}from"./index-ZAZRIL-n.js";import{T as C}from"./trash-2-AcrYeN4V.js";import{P as w}from"./plus-BlyBk2I3.js";import{F as z}from"./file-text-Z3y9FrNB.js";import{U as R}from"./index-DKe4wx0O.js";import{U as T}from"./upload-VxSW6h0e.js";import"./charts-4CCI6hAs.js";import"./ActionButton-DZkZ4UyV.js";import"./context-Co2t6AGx.js";import"./useMergedMask-hWGqm8nf.js";import"./useClosable-BMlLLbW6.js";import"./index-CsPvpU6M.js";import"./DeleteOutlined-B97TiFIe.js";import"./progress-BgTHiS06.js";var S={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M960 509.2c0-2.2 0-4.7-.1-7.6-.1-8.1-.3-17.2-.5-26.9-.8-27.9-2.2-55.7-4.4-81.9-3-36.1-7.4-66.2-13.4-88.8a139.52 139.52 0 00-98.3-98.5c-28.3-7.6-83.7-12.3-161.7-15.2-37.1-1.4-76.8-2.3-116.5-2.8-13.9-.2-26.8-.3-38.4-.4h-29.4c-11.6.1-24.5.2-38.4.4-39.7.5-79.4 1.4-116.5 2.8-78 3-133.5 7.7-161.7 15.2A139.35 139.35 0 0082.4 304C76.3 326.6 72 356.7 69 392.8c-2.2 26.2-3.6 54-4.4 81.9-.3 9.7-.4 18.8-.5 26.9 0 2.9-.1 5.4-.1 7.6v5.6c0 2.2 0 4.7.1 7.6.1 8.1.3 17.2.5 26.9.8 27.9 2.2 55.7 4.4 81.9 3 36.1 7.4 66.2 13.4 88.8 12.8 47.9 50.4 85.7 98.3 98.5 28.2 7.6 83.7 12.3 161.7 15.2 37.1 1.4 76.8 2.3 116.5 2.8 13.9.2 26.8.3 38.4.4h29.4c11.6-.1 24.5-.2 38.4-.4 39.7-.5 79.4-1.4 116.5-2.8 78-3 133.5-7.7 161.7-15.2 47.9-12.8 85.5-50.5 98.3-98.5 6.1-22.6 10.4-52.7 13.4-88.8 2.2-26.2 3.6-54 4.4-81.9.3-9.7.4-18.8.5-26.9 0-2.9.1-5.4.1-7.6v-5.6zm-72 5.2c0 2.1 0 4.4-.1 7.1-.1 7.8-.3 16.4-.5 25.7-.7 26.6-2.1 53.2-4.2 77.9-2.7 32.2-6.5 58.6-11.2 76.3-6.2 23.1-24.4 41.4-47.4 47.5-21 5.6-73.9 10.1-145.8 12.8-36.4 1.4-75.6 2.3-114.7 2.8-13.7.2-26.4.3-37.8.3h-28.6l-37.8-.3c-39.1-.5-78.2-1.4-114.7-2.8-71.9-2.8-124.9-7.2-145.8-12.8-23-6.2-41.2-24.4-47.4-47.5-4.7-17.7-8.5-44.1-11.2-76.3-2.1-24.7-3.4-51.3-4.2-77.9-.3-9.3-.4-18-.5-25.7 0-2.7-.1-5.1-.1-7.1v-4.8c0-2.1 0-4.4.1-7.1.1-7.8.3-16.4.5-25.7.7-26.6 2.1-53.2 4.2-77.9 2.7-32.2 6.5-58.6 11.2-76.3 6.2-23.1 24.4-41.4 47.4-47.5 21-5.6 73.9-10.1 145.8-12.8 36.4-1.4 75.6-2.3 114.7-2.8 13.7-.2 26.4-.3 37.8-.3h28.6l37.8.3c39.1.5 78.2 1.4 114.7 2.8 71.9 2.8 124.9 7.2 145.8 12.8 23 6.2 41.2 24.4 47.4 47.5 4.7 17.7 8.5 44.1 11.2 76.3 2.1 24.7 3.4 51.3 4.2 77.9.3 9.3.4 18 .5 25.7 0 2.7.1 5.1.1 7.1v4.8zM423 646l232-135-232-133z"}}]},name:"youtube",theme:"outlined"};function O(){return O=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},O.apply(this,arguments)}const I=(t,s)=>h.createElement(e,O({},t,{ref:s,icon:S})),F=h.forwardRef(I);window.katex=j,window.__quillResizeRegistered||(g.imports&&g.imports["modules/resize"]||g.register("modules/resize",b),window.__quillResizeRegistered=!0);class H extends h.Component{constructor(e){super(e),this.state={editorHtml:e.value||""},this.reactQuillRef=p.createRef()}handleChange=e=>{this.setState({editorHtml:e}),this.props.onChange(e)};handlePlainChange=e=>{const t=e?.target?.value??"";this.setState({editorHtml:t}),this.props.onChange(t)};componentDidUpdate(e){e.value!==this.props.value&&this.setState({editorHtml:this.props.value})}render(){const{placeholder:e,height:r,classname:n,variant:l,label:o,helper:d,maxLength:m,showCount:c}=this.props,h="short"===l,p=r||(h?"160px":"350px");return t.jsxs(u.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},className:`border-editor ${n}`,style:{minHeight:p,display:"flex",flexDirection:"column",width:"100%",borderRadius:12,border:"1px solid #e6eaf2",background:"#fff",boxShadow:"0 8px 24px rgba(15, 23, 42, 0.06)",padding:12,gap:8},children:[(o||d)&&t.jsxs(s,{direction:"vertical",size:2,children:[o&&t.jsx(a.Text,{strong:!0,style:{fontSize:14},children:o}),d&&t.jsx(a.Text,{type:"secondary",style:{fontSize:12},children:d})]}),h?t.jsx(i.TextArea,{value:this.state.editorHtml,onChange:this.handlePlainChange,placeholder:e,autoSize:{minRows:4,maxRows:8},maxLength:m,showCount:c,style:{minHeight:p,borderRadius:10,borderColor:"#e6eaf2"}}):t.jsx(x,{ref:this.reactQuillRef,theme:"snow",value:this.state.editorHtml,onChange:this.handleChange,modules:H.modules(),formats:H.formats,placeholder:e,className:"react-quill",style:{minHeight:p,display:"flex",flexDirection:"column",borderRadius:10,overflow:"hidden"}})]})}}H.modules=()=>({toolbar:{container:[[{header:"1"},{header:"2"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video","formula"],["clean"]]},clipboard:{matchVisual:!1},resize:{modules:["Resize"]}}),H.formats=["header","font","size","bold","italic","underline","strike","blockquote","list","indent","link","image","video","formula"],H.propTypes={placeholder:f.string,value:f.string,onChange:f.func.isRequired,height:f.string,classname:f.string,variant:f.string,label:f.string,helper:f.string,maxLength:f.number,showCount:f.bool};const L=({chapterModalOpen:e,editingChapter:a,onCancelChapter:h,onOkChapter:p,chapterForm:u,gradeOptions:x,classOptions:j,contentModalOpen:g,editingContent:b,onCancelContent:f,onOkContent:S,contentForm:O})=>{const[I,{isLoading:L}]=r();return t.jsxs(t.Fragment,{children:[t.jsx(v,{title:a?"Edit Bab":"Tambah Bab",open:e,onCancel:h,onOk:p,okText:a?"Simpan":"Tambah",destroyOnHidden:!0,centered:!0,width:820,children:t.jsxs(n,{layout:"vertical",form:u,children:[t.jsx(n.Item,{name:"title",label:"Judul Bab",rules:[{required:!0,message:"Judul wajib diisi."}],children:t.jsx(i,{placeholder:"Contoh: Bab 1 - Pengenalan"})}),t.jsx(n.Item,{name:"description",label:"Deskripsi",children:t.jsx(H,{placeholder:"Deskripsi singkat bab.",height:"160px"})}),t.jsxs(l,{gutter:[12,12],children:[t.jsx(o,{xs:24,md:8,children:t.jsx(n.Item,{name:"order_number",label:"Urutan",children:t.jsx(y,{min:1,style:{width:"100%"}})})}),t.jsx(o,{xs:24,md:8,children:t.jsx(n.Item,{name:"grade_id",label:"Tingkat",rules:[{required:!0,message:"Tingkat wajib diisi."}],children:t.jsx(k,{options:x})})}),t.jsx(o,{xs:24,md:8,children:t.jsx(n.Item,{name:"class_ids",label:"Kelas",rules:[{required:!0,message:"Kelas wajib diisi."}],children:t.jsx(k,{mode:"multiple",options:j})})})]})]})}),t.jsx(v,{title:b?"Edit Subbab":"Tambah Subbab",open:g,onCancel:f,onOk:S,okText:b?"Simpan":"Tambah",destroyOnHidden:!0,centered:!0,width:820,children:t.jsxs(n,{layout:"vertical",form:O,children:[t.jsxs(l,{gutter:[12,12],children:[t.jsx(o,{xs:24,md:12,children:t.jsx(n.Item,{name:"title",label:"Judul Subbab",rules:[{required:!0,message:"Judul wajib diisi."}],children:t.jsx(i,{placeholder:"Contoh: Materi Inti"})})}),t.jsx(o,{xs:24,md:12,children:t.jsx(n.Item,{label:"Link Youtube",children:t.jsx(n.List,{name:"video_urls",children:(e,{add:a,remove:r})=>t.jsxs(d,{vertical:!0,gap:8,children:[e.map(e=>t.jsxs(s.Compact,{style:{width:"100%"},children:[t.jsx(n.Item,{...e,style:{flex:1,marginBottom:0},rules:[{validator:(e,t)=>{if(!t||!String(t).trim())return Promise.resolve();return/(youtube\.com|youtu\.be)/i.test(String(t))?Promise.resolve():Promise.reject(new Error("Masukkan link YouTube yang valid."))}}],children:t.jsx(i,{prefix:t.jsx(F,{}),placeholder:"https://youtube.com/..."})}),t.jsx(m,{danger:!0,icon:t.jsx(C,{size:14}),onClick:()=>r(e.name)})]},e.key)),t.jsx(m,{type:"dashed",icon:t.jsx(w,{size:14}),onClick:()=>a(""),children:"Tambah Link"})]})})})})]}),t.jsx(n.Item,{name:"body",label:"Deskripsi",children:t.jsx(H,{placeholder:"Ringkasan materi.",height:"180px"})}),t.jsx(n.Item,{label:"File Lampiran",extra:"Format umum: pdf, docx, pptx, xlsx, gambar.",children:t.jsx(n.List,{name:"attachments",children:(e,{add:a,remove:r})=>t.jsxs(d,{vertical:!0,gap:8,children:[e.map(e=>t.jsxs(l,{gutter:[8,8],children:[t.jsx(o,{xs:24,md:14,children:t.jsx(n.Item,{name:[e.name,"url"],rules:[{validator:(e,t)=>{if(!t||!String(t).trim())return Promise.resolve();const s=String(t).trim();return/^https?:\/\//i.test(s)||s.startsWith("/assets/")?Promise.resolve():Promise.reject(new Error("Masukkan URL valid atau path /assets/..."))}}],style:{marginBottom:0},children:t.jsx(i,{prefix:t.jsx(z,{size:14}),placeholder:"Upload atau tempel link file"})})}),t.jsx(o,{xs:24,md:6,children:t.jsx(n.Item,{name:[e.name,"name"],style:{marginBottom:0},children:t.jsx(i,{placeholder:"Nama file"})})}),t.jsx(o,{xs:24,md:4,children:t.jsxs(s.Compact,{style:{width:"100%"},children:[t.jsx(R,{beforeUpload:t=>(async(e,t)=>{try{const s=new FormData;s.append("file",e);const a=await I(s).unwrap(),i=a?.data?.url,r=a?.data?.name;if(!i)return c.error("Upload gagal."),!1;const n=[...O.getFieldValue("attachments")||[]];n[t]={...n[t]||{},url:i,name:r||null},O.setFieldsValue({attachments:n}),c.success("File berhasil diupload.")}catch(s){c.error(s?.data?.message||"Gagal upload file.")}return!1})(t,e.name),showUploadList:!1,maxCount:1,children:t.jsx(m,{type:"primary",icon:t.jsx(T,{size:14}),loading:L,children:"Upload"})}),t.jsx(m,{danger:!0,icon:t.jsx(C,{size:14}),onClick:()=>r(e.name)})]})})]},e.key)),t.jsx(m,{type:"dashed",icon:t.jsx(w,{size:14}),onClick:()=>a({url:"",name:""}),children:"Tambah File"})]})})})]})})]})};export{L as default};
