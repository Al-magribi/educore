import{l as e,F as a,bt as s,bu as i,bv as t,bw as r,bx as o,o as n,T as d,aL as l,x as c,B as m,s as x,M as p,z as h}from"./index-DJgzJvx0.js";import{r as j}from"./vendor-kOq7Q5-U.js";import{I as u}from"./InfiniteScrollList-CRQVFRuq.js";import{S as f}from"./search-DCbkSk8T.js";import{P as g}from"./plus-BlyBk2I3.js";import{M as b}from"./index-CWRbA1GH.js";import{B as y}from"./index-B466D75m.js";import{C as k}from"./calendar-BUsp4a-K.js";import{T as v}from"./index-A8UrXWNV.js";import{P as w}from"./index-C1pdE3N8.js";import{C as _}from"./circle-check-big-D25bT2vM.js";import{P as T}from"./pencil-BHIqPcQ5.js";import{T as C}from"./trash-2-AcrYeN4V.js";import"./charts-4CCI6hAs.js";import"./index-CsPvpU6M.js";import"./index-BzygXUWO.js";import"./index-Ddh-PgSR.js";import"./ActionButton-DZkZ4UyV.js";import"./context-Co2t6AGx.js";import"./useMergedMask-hWGqm8nf.js";import"./useClosable-BMlLLbW6.js";const{Title:P,Text:B}=d,S=({screens:d})=>{const{user:S}=e(e=>e.auth),[M,z]=j.useState(1),[A,L]=j.useState(""),[I,E]=j.useState([]),[F,D]=j.useState(!1),[G,H]=j.useState(null),[N]=a.useForm(),{data:q,isFetching:O,refetch:Y}=s({page:M,limit:10,search:A,homebase_id:S?.homebase_id}),[J,{isLoading:K}]=i(),[R,{isLoading:V}]=t(),[W,{isLoading:Q}]=r(),[U,{isLoading:X}]=o();j.useEffect(()=>{q?.data&&E(1===M?q.data:e=>{const a=q.data.filter(a=>!e.some(e=>e.id===a.id));return[...e,...a]})},[q,M]),j.useEffect(()=>{z(1)},[A]);const Z=(e=null)=>{H(e),e?N.setFieldsValue({name:e.name}):N.resetFields(),D(!0)};return n.jsxs("div",{style:{padding:24},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:d.xs?"flex-start":"center",marginBottom:16,flexWrap:"wrap",gap:10},children:[n.jsx(P,{level:4,style:{margin:0},children:"Daftar Periode"}),n.jsxs(l,{gap:8,vertical:!!d.xs,align:d.xs?"stretch":"center",justify:"flex-end",style:{width:d.xs?"100%":"auto"},children:[n.jsx(c,{placeholder:"Cari periode...",prefix:n.jsx(f,{size:16,color:"#bfbfbf"}),allowClear:!0,onChange:e=>L(e.target.value),style:{width:d.xs?"100%":260}}),n.jsx(m,{type:"primary",icon:n.jsx(g,{size:18}),onClick:()=>Z(null),style:{width:d.xs?"100%":"auto"},children:"Tambah"})]})]}),n.jsx(u,{data:I,loading:O,hasMore:q?.hasMore,onLoadMore:()=>{q?.hasMore&&!O&&z(e=>e+1)},renderItem:e=>n.jsx(y.Ribbon,{text:e.is_active?"Aktif":"Non-Aktif",color:e.is_active?"green":"default",children:n.jsx(x,{hoverable:!0,style:{height:"100%",display:"flex",flexDirection:"column"},styles:{body:{flex:1,padding:"16px"}},actions:[n.jsx(w,{title:"Aktifkan periode ini?",description:"Periode lain dalam satu homebase akan dinonaktifkan.",onConfirm:()=>(async e=>{try{await U(e).unwrap(),h.success("Periode aktif berhasil diubah"),z(1),Y()}catch(a){h.error(a?.data?.message||"Gagal mengaktifkan")}})(e.id),disabled:e.is_active,okText:"Ya, Aktifkan",cancelText:"Batal",children:n.jsx(p,{title:e.is_active?"Sudah Aktif":"Set sebagai Aktif",children:n.jsx(m,{type:"text",icon:n.jsx(_,{size:18,color:e.is_active?"#52c41a":void 0}),disabled:e.is_active})})},"activate"),n.jsx(p,{title:"Edit Nama",children:n.jsx(m,{type:"text",icon:n.jsx(T,{size:18,color:"#faad14"}),onClick:()=>Z(e)})},"edit"),n.jsx(w,{title:"Hapus periode?",description:"Data tidak dapat dikembalikan.",onConfirm:()=>(async e=>{try{await W(e).unwrap(),h.success("Periode dihapus"),z(1),Y()}catch(a){h.error(a?.data?.message||"Gagal menghapus")}})(e.id),okText:"Ya, Hapus",cancelText:"Batal",disabled:e.is_active,children:n.jsx(m,{type:"text",danger:!0,icon:n.jsx(C,{size:18}),disabled:e.is_active,loading:Q})},"delete")],children:n.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[n.jsx(k,{size:24,color:"#1890ff",style:{marginTop:4}}),n.jsxs("div",{children:[n.jsx(P,{level:5,style:{margin:0},children:e.name}),n.jsxs(B,{type:"secondary",style:{fontSize:12},children:["Homebase: ",e.homebase_name||"-"]}),n.jsx("div",{style:{marginTop:8},children:e.is_active?n.jsx(v,{color:"success",children:"Sedang Berlangsung"}):n.jsx(v,{color:"default",children:"Arsip"})})]})]})})}),emptyText:"Belum ada data periode",grid:{gutter:[16,16],xs:24,sm:12,md:8,lg:6,xl:6,xxl:4}}),n.jsx(b,{title:G?"Edit Periode":"Tambah Periode Baru",open:F,onCancel:()=>D(!1),onOk:N.submit,confirmLoading:K||V,destroyOnHidden:!0,children:n.jsx(a,{form:N,layout:"vertical",onFinish:async e=>{try{G?(await R({id:G.id,name:e.name,homebase_id:S?.homebase_id}).unwrap(),h.success("Periode berhasil diperbarui")):(await J({name:e.name,homebase_id:S?.homebase_id}).unwrap(),h.success("Periode berhasil ditambahkan")),D(!1),z(1),Y()}catch(a){h.error(a?.data?.message||"Terjadi kesalahan")}},children:n.jsx(a.Item,{name:"name",label:"Nama Periode",rules:[{required:!0,message:"Nama periode wajib diisi"}],help:"Contoh: 2025/2026 Ganjil",children:n.jsx(c,{placeholder:"Masukkan nama periode..."})})})})]})};export{S as default};
