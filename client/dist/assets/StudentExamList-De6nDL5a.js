import{bg as e,T as a,F as n,de as s,j as t,S as i,A as r,h as l,B as o,s as c,a as d,df as m,d as u,f as j,C as h,g as x,b as f,ac as p}from"./index-BgYL1Jri.js";import{H as y,b as k}from"./vendor-BhwIo2T6.js";import{M as g}from"./index-DLc7ETq3.js";import{B as b}from"./index-CwvbuEbi.js";import{B as _}from"./book-open-C7tP6vTo.js";import{U as w}from"./user-round-BvhmnAPu.js";import{T as S}from"./timer-BeAcrX0b.js";import{E as z}from"./index-DvRJiCh0.js";import{C as v}from"./clipboard-list-CJQixJbO.js";import{G as M}from"./graduation-cap-BxVkdfL_.js";import"./ActionButton-CJaqdhKg.js";const T=e("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]),U=e("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]),{Text:C}=a,A=e=>"pelanggaran"===e?{type:"error",title:"Status: Pelanggaran"}:"mengerjakan"===e?{type:"warning",title:"Status: Mengerjakan"}:"selesai"===e?{type:"info",title:"Status: Selesai"}:null,B=async(e,a=2500)=>{const n=new AbortController,s=setTimeout(()=>n.abort(),a);try{const a=await fetch(e,{signal:n.signal,cache:"no-store"});if(!a.ok)return null;const s=await a.json(),t=s?.ip||s?.ip_addr||s?.address;return"string"==typeof t&&t.trim()?t.trim():null}catch(t){return null}finally{clearTimeout(s)}},F=async()=>{if("undefined"==typeof window||"function"!=typeof fetch)return null;const e=["https://api64.ipify.org?format=json","https://api.ipify.org?format=json","https://ifconfig.me/all.json"];for(const a of e){const e=await B(a);if(e)return e}return null},q=({open:e,onClose:a,exam:d})=>{const[m]=n.useForm(),u=y(),[j,{isLoading:h}]=s(),[x,f]=k.useState(null),[p,b]=k.useState(null);k.useEffect(()=>{e&&(m.resetFields(),f(null),b(null),F().then(e=>b(e)))},[e,m]);return t.jsx(g,{title:t.jsxs(i,{align:"center",size:8,children:[t.jsx(U,{size:18}),t.jsx("span",{children:"Masukkan Token Ujian"})]}),open:e,onCancel:a,footer:null,centered:!0,destroyOnHidden:!0,children:t.jsxs(i,{vertical:!0,size:12,style:{width:"100%"},children:[t.jsx(C,{type:"secondary",children:d?.name?`Ujian: ${d.name}`:"Pastikan token sesuai jadwal."}),x&&A(x.status)&&t.jsx(r,{type:A(x.status).type,title:A(x.status).title,description:x.message,showIcon:!0}),t.jsxs(n,{form:m,layout:"vertical",onFinish:async e=>{try{f(null);const n=p||await F();await j({exam_id:d?.id,token:e.token?.trim(),student_ip:n||void 0}).unwrap(),await(async()=>{if("undefined"==typeof document)return!1;if(document.fullscreenElement)return!0;const e=document.documentElement;if(!e?.requestFullscreen)return!1;try{return await e.requestFullscreen(),!0}catch(a){return!1}})(),c.success("Token valid. Selamat mengerjakan ujian."),u(`/computer-based-test/start?exam_id=${d?.id}&exam_name=${d?.name?.replaceAll(" ","-")}`),a()}catch(n){const e=n?.data?.status||null,a=n?.data?.message||"Token ujian tidak valid";e?f({status:e,message:a}):c.error(a)}},children:[t.jsx(n.Item,{label:"Token Ujian",name:"token",rules:[{required:!0,message:"Token ujian wajib diisi"}],children:t.jsx(l,{placeholder:"Masukkan token ujian"})}),t.jsx(C,{type:"secondary",style:{fontSize:12},children:"Status ujian: Belum Masuk = belum mengikuti, Pelanggaran = keluar dari halaman ujian, Mengerjakan = masih berlangsung, Selesai = sudah menjawab semua soal."}),t.jsxs(i,{style:{width:"100%",justifyContent:"flex-end"},children:[t.jsx(o,{onClick:a,children:"Batal"}),t.jsx(o,{type:"primary",htmlType:"submit",loading:h,children:"Verifikasi"})]})]})]})})},{Title:E,Text:I}=a,J=()=>{const e=d.c(36),{data:a,isLoading:n,isError:s}=m(),[r,l]=k.useState(null),[c,y]=k.useState(!1),g=a?.length||0;let U;a?.reduce(P,0),e[0]!==a?(U=new Set((a||[]).map(D).filter(Boolean)),e[0]=a,e[1]=U):U=e[1];const C=U.size,A=a?.[0]?.class_name||"Kelas belum tersedia";if(n){let a;return e[2]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(f,{title:"Jadwal Ujian",children:t.jsx(u,{children:t.jsx(p,{active:!0,paragraph:{rows:6}})})}),e[2]=a):a=e[2],a}if(s){let a;return e[3]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(f,{title:"Jadwal Ujian",children:t.jsx(u,{children:t.jsx(I,{type:"danger",children:"Gagal memuat jadwal ujian."})})}),e[3]=a):a=e[3],a}let B;e[4]===Symbol.for("react.memo_cache_sentinel")?(B=e=>{l(e),y(!0)},e[4]=B):B=e[4];const F=B;let J;e[5]===Symbol.for("react.memo_cache_sentinel")?(J=()=>{y(!1),l(null)},e[5]=J):J=e[5];const H=J;let R,V,$,G,L,K,N,O,Q,W,X,Y,Z,ee,ae,ne,se;return e[6]===Symbol.for("react.memo_cache_sentinel")?(R={width:"100%"},e[6]=R):R=e[6],e[7]===Symbol.for("react.memo_cache_sentinel")?(V={width:"100%"},e[7]=V):V=e[7],e[8]===Symbol.for("react.memo_cache_sentinel")?($=t.jsx("div",{style:{width:44,height:44,borderRadius:12,background:"#eef2ff",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(v,{size:20,color:"#4f46e5"})}),e[8]=$):$=e[8],e[9]===Symbol.for("react.memo_cache_sentinel")?(G=t.jsxs(i,{align:"center",size:12,children:[$,t.jsxs("div",{children:[t.jsx(E,{level:4,style:{margin:0},children:"Jadwal Ujian"}),t.jsx(I,{type:"secondary",children:"Daftar ujian aktif sesuai kelas Anda"})]})]}),e[9]=G):G=e[9],e[10]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsx(M,{size:12}),e[10]=L):L=e[10],e[11]!==A?(K=t.jsx(x,{color:"blue",icon:L,children:A}),e[11]=A,e[12]=K):K=e[12],e[13]===Symbol.for("react.memo_cache_sentinel")?(N=t.jsx(_,{size:12}),e[13]=N):N=e[13],e[14]!==C?(O=t.jsxs(x,{color:"geekblue",icon:N,children:[C," Mapel"]}),e[14]=C,e[15]=O):O=e[15],e[16]===Symbol.for("react.memo_cache_sentinel")?(Q=t.jsx(T,{size:12}),e[16]=Q):Q=e[16],e[17]!==g?(W=t.jsxs(x,{color:"purple",icon:Q,children:[g," Ujian Aktif"]}),e[17]=g,e[18]=W):W=e[18],e[19]!==O||e[20]!==W||e[21]!==K?(X=t.jsx(u,{hoverable:!0,children:t.jsxs(i,{vertical:!0,size:10,style:V,children:[G,t.jsxs(i,{wrap:!0,size:8,children:[K,O,W]})]})}),e[19]=O,e[20]=W,e[21]=K,e[22]=X):X=e[22],e[23]===Symbol.for("react.memo_cache_sentinel")?(Y=t.jsxs(i,{align:"center",size:8,children:[t.jsx(v,{size:18,color:"#1d4ed8"}),t.jsx("span",{children:"Daftar Ujian"})]}),Z={borderRadius:16},e[23]=Y,e[24]=Z):(Y=e[23],Z=e[24]),e[25]!==a?(ee=t.jsx(u,{title:Y,style:Z,children:a?.length?t.jsx(j,{gutter:[16,16],children:a.map(e=>t.jsx(h,{xs:24,md:12,xl:8,children:t.jsx(b.Ribbon,{text:e.bank_type||"Ujian",children:t.jsx(u,{hoverable:!0,actions:[t.jsx(o,{type:"primary",onClick:()=>F(e),children:"Ikuti Ujian"})],children:t.jsxs(i,{vertical:!0,size:10,style:{width:"100%"},children:[t.jsxs(i,{align:"center",size:8,children:[t.jsx(I,{strong:!0,children:e.name}),t.jsx(x,{color:"green",children:"Aktif"})]}),t.jsxs(i,{size:12,wrap:!0,children:[t.jsxs(I,{type:"secondary",children:[t.jsx(_,{size:14})," ",e.subject_name||"-"]}),t.jsxs(I,{type:"secondary",children:[t.jsx(w,{size:14})," ",e.teacher_name||"-"]}),t.jsxs(I,{type:"secondary",children:[t.jsx(S,{size:14})," ",e.duration_minutes," menit"]})]})]})})})},e.id))}):t.jsx(z,{description:"Belum ada jadwal ujian untuk kelas Anda."})}),e[25]=a,e[26]=ee):ee=e[26],e[27]!==X||e[28]!==ee?(ae=t.jsxs(i,{vertical:!0,size:20,style:R,children:[X,ee]}),e[27]=X,e[28]=ee,e[29]=ae):ae=e[29],e[30]!==r||e[31]!==c?(ne=t.jsx(q,{open:c,onClose:H,exam:r}),e[30]=r,e[31]=c,e[32]=ne):ne=e[32],e[33]!==ae||e[34]!==ne?(se=t.jsxs(f,{title:"Jadwal Ujian",children:[ae,ne]}),e[33]=ae,e[34]=ne,e[35]=se):se=e[35],se};function P(e,a){return e+Number(a.duration_minutes||0)}function D(e){return e.subject_name}export{J as default};
