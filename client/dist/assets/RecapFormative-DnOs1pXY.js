import{k as e,ey as t,o as a,s,M as n,T as i,X as r,aL as o,B as l}from"./index-DJgzJvx0.js";import"./vendor-kOq7Q5-U.js";import{utils as c,writeFile as m}from"./xlsx-3FAc2Sll.js";import{S as d}from"./index-ZAZRIL-n.js";import{A as h}from"./index-D-YBaVh2.js";import{E as p}from"./index-CsPvpU6M.js";import{F as u}from"./Table-Bpp4NRb8.js";import{T as f}from"./index-A8UrXWNV.js";import{F as x}from"./funnel-CQS6Mpx9.js";import{R as _}from"./refresh-ccw-CYu9ftZ8.js";import{D as j}from"./download-CnFHAq_0.js";import{U as y}from"./users-DP4QiVnj.js";import"./charts-4CCI6hAs.js";import"./index-Bjno29EH.js";import"./index-BzygXUWO.js";import"./useClosable-BMlLLbW6.js";const{Title:g,Text:b}=i,v=e=>Math.round(100*Number(e||0))/100,w=n=>{const i=e.c(103),{isActive:w,subjectId:C,subject:R,activePeriode:z,classes:P,classLoading:A,classId:F,setClassId:M,semester:B,setSemester:H,isAdminView:L,teacherId:W,setTeacherId:D,teachers:E,teacherLoading:K,screens:U}=n,V=void 0!==L&&L;let X;i[0]!==E?(X=void 0===E?[]:E,i[0]=E,i[1]=X):X=i[1];const q=X,G=void 0!==K&&K;let J;i[2]!==F||i[3]!==B||i[4]!==C||i[5]!==W?(J={subjectId:C,classId:F,semester:B,teacherId:W},i[2]=F,i[3]=B,i[4]=C,i[5]=W,i[6]=J):J=i[6];const O=!w||!C||!F||!B||V&&!W;let Q;i[7]!==O?(Q={skip:O},i[7]=O,i[8]=Q):Q=i[8];const{data:Y,isFetching:Z,refetch:ee}=t(J,Q);let te;i[9]!==Y?.data?(te=Y?.data||{},i[9]=Y?.data,i[10]=te):te=i[10];const ae=te;let se;i[11]!==ae?.summary?(se=ae?.summary||{},i[11]=ae?.summary,i[12]=se):se=i[12];const ne=se;let ie;i[13]!==ae?.month_matrix?(ie=ae?.month_matrix||[],i[13]=ae?.month_matrix,i[14]=ie):ie=i[14];const re=ie;let oe;i[15]!==ae?.students?(oe=ae?.students||[],i[15]=ae?.students,i[16]=oe):oe=i[16];const le=oe;let ce;i[17]!==le?(ce=le.map(S),i[17]=le,i[18]=ce):ce=i[18];const me=ce;let de;i[19]===Symbol.for("react.memo_cache_sentinel")?(de=[{title:"No",dataIndex:"no",width:64,align:"center",fixed:"left"},{title:"NIS",dataIndex:"nis",width:120,fixed:"left"},{title:"Nama Siswa",dataIndex:"full_name",width:220,fixed:"left",render:k}],i[19]=de):de=i[19];const he=de;let pe;if(i[20]!==re){const e=re.map(I);let t;i[22]===Symbol.for("react.memo_cache_sentinel")?(t=[{title:"Nilai Harian",dataIndex:"daily_average",width:128,align:"center",render:N}],i[22]=t):t=i[22];pe=[...he,...e,...t],i[20]=re,i[21]=pe}else pe=i[21];const ue=pe;let fe;i[23]!==F||i[24]!==P||i[25]!==re||i[26]!==me||i[27]!==B?(fe=()=>{if(!me.length)return;const e=((e,t)=>e.map(e=>{const a={No:e.no,NIS:e.nis,"Nama Siswa":e.full_name};for(const s of t){const t=String(s.month),n=e.month_scores?.[t]?.formative||[],i=Math.max(1,Number(s.max_formative_entries||0)),r=s.entries||[];for(let e=0;e<i;e+=1){const t=r[e]?.chapter_title||"-",i=r[e]?.slot_key,o=i?n.find(e=>e?.slot_key===i):n[e],l=o&&"object"==typeof o?o.score:o;a[`${s.month_name} - Formatif Nilai ${e+1} (${t})`]=l??"-"}}return a["Nilai Harian"]=v(e.daily_average),a}))(me,re),t=c.json_to_sheet(e),a=c.book_new();c.book_append_sheet(a,t,"Rekap Nilai Semester");const s=`Rekap_Nilai_Semester_${P.find(e=>String(e.id)===String(F))?.name||"Kelas"}_Semester${B}`.replace(/[\\/:*?"<>|]/g,"-");m(a,`${s}.xlsx`)},i[23]=F,i[24]=P,i[25]=re,i[26]=me,i[27]=B,i[28]=fe):fe=i[28];const xe=fe;let _e,je,ye;i[29]===Symbol.for("react.memo_cache_sentinel")?(_e={borderRadius:16},je={body:{padding:20}},i[29]=_e,i[30]=je):(_e=i[29],je=i[30]),i[31]===Symbol.for("react.memo_cache_sentinel")?(ye=a.jsxs(r,{vertical:!0,size:2,children:[a.jsx(g,{level:5,style:{margin:0},children:"Rekapitulasi Formatif"}),a.jsx(b,{type:"secondary",children:"Rekap nilai formatif dalam satu semester"})]}),i[31]=ye):ye=i[31];const ge=R?.name||"Mata Pelajaran";let be;i[32]!==ge?(be=a.jsx(f,{color:"blue",children:ge}),i[32]=ge,i[33]=be):be=i[33];const ve=z?.name||ae?.meta?.periode_name||"Periode";let we,Se,ke,Ie,Ne,$e,Te,Ce,Re,ze,Pe,Ae,Fe,Me,Be;i[34]!==ve?(we=a.jsx(f,{color:"processing",children:ve}),i[34]=ve,i[35]=we):we=i[35],i[36]!==be||i[37]!==we?(Se=a.jsxs(o,{justify:"space-between",align:"center",wrap:"wrap",gap:12,children:[ye,a.jsxs(r,{wrap:!0,children:[be,we]})]}),i[36]=be,i[37]=we,i[38]=Se):Se=i[38],i[39]===Symbol.for("react.memo_cache_sentinel")?(ke={marginTop:16},i[39]=ke):ke=i[39],i[40]===Symbol.for("react.memo_cache_sentinel")?(Ie={minWidth:160},Ne=[{value:1,label:"Semester 1"},{value:2,label:"Semester 2"}],$e=a.jsx(x,{size:14}),i[40]=Ie,i[41]=Ne,i[42]=$e):(Ie=i[40],Ne=i[41],$e=i[42]),i[43]!==B||i[44]!==H?(Te=a.jsx(d,{value:B,onChange:H,style:Ie,options:Ne,suffixIcon:$e}),i[43]=B,i[44]=H,i[45]=Te):Te=i[45],i[46]!==V||i[47]!==D||i[48]!==W||i[49]!==G||i[50]!==q?(Ce=V&&a.jsx(d,{value:W,onChange:D,style:{minWidth:220},placeholder:"Pilih guru",options:q.map($),loading:G}),i[46]=V,i[47]=D,i[48]=W,i[49]=G,i[50]=q,i[51]=Ce):Ce=i[51],i[52]===Symbol.for("react.memo_cache_sentinel")?(Re={minWidth:220},i[52]=Re):Re=i[52],i[53]!==P?(ze=P.map(T),i[53]=P,i[54]=ze):ze=i[54],i[55]!==F||i[56]!==A||i[57]!==M||i[58]!==ze?(Pe=a.jsx(d,{value:F,onChange:M,style:Re,placeholder:"Pilih kelas",options:ze,loading:A}),i[55]=F,i[56]=A,i[57]=M,i[58]=ze,i[59]=Pe):Pe=i[59],i[60]!==Te||i[61]!==Ce||i[62]!==Pe?(Ae=a.jsxs(r,{wrap:!0,children:[Te,Ce,Pe]}),i[60]=Te,i[61]=Ce,i[62]=Pe,i[63]=Ae):Ae=i[63],i[64]===Symbol.for("react.memo_cache_sentinel")?(Fe=a.jsx(_,{size:14}),i[64]=Fe):Fe=i[64],i[65]!==ee?(Me=a.jsx(l,{icon:Fe,onClick:ee,children:"Refresh"}),i[65]=ee,i[66]=Me):Me=i[66],i[67]===Symbol.for("react.memo_cache_sentinel")?(Be=a.jsx(j,{size:14}),i[67]=Be):Be=i[67];const He=!me.length;let Le,We,De,Ee,Ke;i[68]!==xe||i[69]!==He?(Le=a.jsx(l,{type:"primary",icon:Be,disabled:He,onClick:xe,children:"Download Excel"}),i[68]=xe,i[69]=He,i[70]=Le):Le=i[70],i[71]!==Me||i[72]!==Le?(We=a.jsxs(r,{wrap:!0,children:[Me,Le]}),i[71]=Me,i[72]=Le,i[73]=We):We=i[73],i[74]!==Ae||i[75]!==We?(De=a.jsxs(o,{justify:"space-between",align:"center",wrap:"wrap",gap:12,style:ke,children:[Ae,We]}),i[74]=Ae,i[75]=We,i[76]=De):De=i[76],i[77]===Symbol.for("react.memo_cache_sentinel")?(Ee={marginTop:14},i[77]=Ee):Ee=i[77],i[78]===Symbol.for("react.memo_cache_sentinel")?(Ke=a.jsx(y,{size:12}),i[78]=Ke):Ke=i[78];const Ue=ae?.meta?.total_students||0;let Ve,Xe,qe,Ge,Je,Oe,Qe;return i[79]!==Ue?(Ve=a.jsxs(f,{color:"geekblue",icon:Ke,children:["Total Siswa: ",Ue]}),i[79]=Ue,i[80]=Ve):Ve=i[80],i[81]!==ne.daily_average?(Xe=v(ne.daily_average),i[81]=ne.daily_average,i[82]=Xe):Xe=i[82],i[83]!==Xe?(qe=a.jsxs(f,{color:"cyan",children:["Avg Nilai Harian: ",Xe]}),i[83]=Xe,i[84]=qe):qe=i[84],i[85]!==Ve||i[86]!==qe?(Ge=a.jsxs(o,{wrap:"wrap",gap:8,style:Ee,children:[Ve,qe]}),i[85]=Ve,i[86]=qe,i[87]=Ge):Ge=i[87],i[88]!==Se||i[89]!==De||i[90]!==Ge?(Je=a.jsxs(s,{style:_e,styles:je,children:[Se,De,Ge]}),i[88]=Se,i[89]=De,i[90]=Ge,i[91]=Je):Je=i[91],i[92]!==F||i[93]!==ue||i[94]!==V||i[95]!==Z||i[96]!==me||i[97]!==U||i[98]!==W?(Oe=F?V&&!W?a.jsx(h,{type:"info",showIcon:!0,message:"Pilih guru pengampu untuk menampilkan data yang sesuai tampilan guru."}):a.jsx(s,{style:{borderRadius:16},styles:{body:{padding:0}},children:Z||me.length?a.jsx(u,{rowKey:"key",dataSource:me,columns:ue,loading:Z,pagination:!1,size:U.xs?"small":"middle",scroll:{x:1600},sticky:!0}):a.jsx("div",{style:{padding:24},children:a.jsx(p,{description:"Belum ada data nilai pada filter ini."})})}):a.jsx(h,{type:"info",showIcon:!0,message:"Pilih kelas untuk menampilkan rekap nilai."}),i[92]=F,i[93]=ue,i[94]=V,i[95]=Z,i[96]=me,i[97]=U,i[98]=W,i[99]=Oe):Oe=i[99],i[100]!==Je||i[101]!==Oe?(Qe=a.jsxs(o,{vertical:!0,gap:16,children:[Je,Oe]}),i[100]=Je,i[101]=Oe,i[102]=Qe):Qe=i[102],Qe};function S(e,t){return{key:e.student_id,no:t+1,nis:e.nis||"-",full_name:e.full_name,month_scores:e.month_scores||{},daily_average:Number(e.daily_average||0)}}function k(e){return a.jsx(b,{strong:!0,children:e})}function I(e){const t=String(e.month),s=Math.max(1,Number(e.max_formative_entries||0)),i=e.entries||[],r=Array.from({length:s},(e,s)=>{const r=i[s]?.chapter_title||"-",o=i[s]?.slot_key;return{title:a.jsx(n,{title:r,children:a.jsx("span",{children:`Nilai ${s+1}`})}),key:`${t}-f-${s}`,width:92,align:"center",render:(e,a)=>{const n=a.month_scores?.[t]?.formative||[],i=o?n.find(e=>e?.slot_key===o):n[s];return(i&&"object"==typeof i?i.score:i)??"-"}}});return{title:e.month_name,key:`month-${t}`,children:r}}function N(e){return a.jsx(f,{color:"blue",children:v(e)})}function $(e){return{value:e.id,label:e.full_name}}function T(e){return{value:e.id,label:e.name}}export{w as default};
