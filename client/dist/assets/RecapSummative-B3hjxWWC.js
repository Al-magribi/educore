import{k as e,ez as t,o as s,s as a,M as n,T as i,X as r,aL as l,B as o}from"./index-DJgzJvx0.js";import"./vendor-kOq7Q5-U.js";import{utils as c,writeFile as m}from"./xlsx-3FAc2Sll.js";import{S as d}from"./index-ZAZRIL-n.js";import{A as h}from"./index-D-YBaVh2.js";import{E as u}from"./index-CsPvpU6M.js";import{F as p}from"./Table-Bpp4NRb8.js";import{T as f}from"./index-A8UrXWNV.js";import{F as x}from"./funnel-CQS6Mpx9.js";import{R as _}from"./refresh-ccw-CYu9ftZ8.js";import{D as j}from"./download-CnFHAq_0.js";import{U as g}from"./users-DP4QiVnj.js";import"./charts-4CCI6hAs.js";import"./index-Bjno29EH.js";import"./index-BzygXUWO.js";import"./useClosable-BMlLLbW6.js";const{Title:y,Text:b}=i,k=e=>Math.round(100*Number(e||0))/100,w=(e,t,s,a)=>{const n=e.month_scores?.[t]?.summative||[];return s?n.find(e=>e?.slot_key===s):n[a]},S=n=>{const i=e.c(103),{isActive:S,subjectId:z,subject:C,activePeriode:R,classes:A,classLoading:M,classId:F,setClassId:B,semester:L,setSemester:W,isAdminView:D,teacherId:E,setTeacherId:K,teachers:U,teacherLoading:V,screens:X}=n,q=void 0!==D&&D;let G;i[0]!==U?(G=void 0===U?[]:U,i[0]=U,i[1]=G):G=i[1];const H=G,J=void 0!==V&&V;let O;i[2]!==F||i[3]!==L||i[4]!==z||i[5]!==E?(O={subjectId:z,classId:F,semester:L,teacherId:E},i[2]=F,i[3]=L,i[4]=z,i[5]=E,i[6]=O):O=i[6];const Q=!S||!z||!F||!L||q&&!E;let Y;i[7]!==Q?(Y={skip:Q},i[7]=Q,i[8]=Y):Y=i[8];const{data:Z,isFetching:ee,refetch:te}=t(O,Y);let se;i[9]!==Z?.data?(se=Z?.data||{},i[9]=Z?.data,i[10]=se):se=i[10];const ae=se;let ne;i[11]!==ae?.summary?(ne=ae?.summary||{},i[11]=ae?.summary,i[12]=ne):ne=i[12];const ie=ne;let re;i[13]!==ae?.month_matrix?(re=ae?.month_matrix||[],i[13]=ae?.month_matrix,i[14]=re):re=i[14];const le=re;let oe;i[15]!==ae?.students?(oe=ae?.students||[],i[15]=ae?.students,i[16]=oe):oe=i[16];const ce=oe;let me;i[17]!==ce?(me=ce.map(v),i[17]=ce,i[18]=me):me=i[18];const de=me;let he;i[19]===Symbol.for("react.memo_cache_sentinel")?(he=[{title:"No",dataIndex:"no",width:64,align:"center",fixed:"left"},{title:"NIS",dataIndex:"nis",width:120,fixed:"left"},{title:"Nama Siswa",dataIndex:"full_name",width:220,fixed:"left",render:I}],i[19]=he):he=i[19];const ue=he;let pe;if(i[20]!==le){const e=le.map($);let t;i[22]===Symbol.for("react.memo_cache_sentinel")?(t=[{title:"Nilai Sumatif",dataIndex:"final_average",width:128,align:"center",render:N}],i[22]=t):t=i[22];pe=[...ue,...e,...t],i[20]=le,i[21]=pe}else pe=i[21];const fe=pe;let xe;i[23]!==F||i[24]!==A||i[25]!==le||i[26]!==de||i[27]!==L?(xe=()=>{if(!de.length)return;const e=((e,t)=>e.map(e=>{const s={No:e.no,NIS:e.nis,"Nama Siswa":e.full_name};for(const a of t){const t=String(a.month),n=Math.max(1,Number(a.max_summative_entries||0)),i=a.entries||[];for(let r=0;r<n;r+=1){const n=i[r]?.chapter_title||"-",l=i[r]?.slot_key,o=w(e,t,l,r);s[`${a.month_name} - Tertulis ${r+1} (${n})`]=o?.score_written??"-",s[`${a.month_name} - Praktik ${r+1} (${n})`]=o?.score_skill??"-"}}return s["Nilai Sumatif"]=k(e.final_average),s}))(de,le),t=c.json_to_sheet(e),s=c.book_new();c.book_append_sheet(s,t,"Rekap Nilai Sumatif");const a=`Rekap_Nilai_Sumatif_${A.find(e=>String(e.id)===String(F))?.name||"Kelas"}_Semester${L}`.replace(/[\\/:*?"<>|]/g,"-");m(s,`${a}.xlsx`)},i[23]=F,i[24]=A,i[25]=le,i[26]=de,i[27]=L,i[28]=xe):xe=i[28];const _e=xe;let je,ge,ye;i[29]===Symbol.for("react.memo_cache_sentinel")?(je={borderRadius:16},ge={body:{padding:20}},i[29]=je,i[30]=ge):(je=i[29],ge=i[30]),i[31]===Symbol.for("react.memo_cache_sentinel")?(ye=s.jsxs(r,{vertical:!0,size:2,children:[s.jsx(y,{level:5,style:{margin:0},children:"Rekapitulasi Sumatif"}),s.jsx(b,{type:"secondary",children:"Rekap nilai sumatif dalam satu semester"})]}),i[31]=ye):ye=i[31];const be=C?.name||"Mata Pelajaran";let ke;i[32]!==be?(ke=s.jsx(f,{color:"blue",children:be}),i[32]=be,i[33]=ke):ke=i[33];const we=R?.name||ae?.meta?.periode_name||"Periode";let Se,ve,Ie,$e,Ne,Te,Pe,ze,Ce,Re,Ae,Me,Fe,Be,Le;i[34]!==we?(Se=s.jsx(f,{color:"processing",children:we}),i[34]=we,i[35]=Se):Se=i[35],i[36]!==ke||i[37]!==Se?(ve=s.jsxs(l,{justify:"space-between",align:"center",wrap:"wrap",gap:12,children:[ye,s.jsxs(r,{wrap:!0,children:[ke,Se]})]}),i[36]=ke,i[37]=Se,i[38]=ve):ve=i[38],i[39]===Symbol.for("react.memo_cache_sentinel")?(Ie={marginTop:16},i[39]=Ie):Ie=i[39],i[40]===Symbol.for("react.memo_cache_sentinel")?($e={minWidth:160},Ne=[{value:1,label:"Semester 1"},{value:2,label:"Semester 2"}],Te=s.jsx(x,{size:14}),i[40]=$e,i[41]=Ne,i[42]=Te):($e=i[40],Ne=i[41],Te=i[42]),i[43]!==L||i[44]!==W?(Pe=s.jsx(d,{value:L,onChange:W,style:$e,options:Ne,suffixIcon:Te}),i[43]=L,i[44]=W,i[45]=Pe):Pe=i[45],i[46]!==q||i[47]!==K||i[48]!==E||i[49]!==J||i[50]!==H?(ze=q&&s.jsx(d,{value:E,onChange:K,style:{minWidth:220},placeholder:"Pilih guru",options:H.map(T),loading:J}),i[46]=q,i[47]=K,i[48]=E,i[49]=J,i[50]=H,i[51]=ze):ze=i[51],i[52]===Symbol.for("react.memo_cache_sentinel")?(Ce={minWidth:220},i[52]=Ce):Ce=i[52],i[53]!==A?(Re=A.map(P),i[53]=A,i[54]=Re):Re=i[54],i[55]!==F||i[56]!==M||i[57]!==B||i[58]!==Re?(Ae=s.jsx(d,{value:F,onChange:B,style:Ce,placeholder:"Pilih kelas",options:Re,loading:M}),i[55]=F,i[56]=M,i[57]=B,i[58]=Re,i[59]=Ae):Ae=i[59],i[60]!==Pe||i[61]!==ze||i[62]!==Ae?(Me=s.jsxs(r,{wrap:!0,children:[Pe,ze,Ae]}),i[60]=Pe,i[61]=ze,i[62]=Ae,i[63]=Me):Me=i[63],i[64]===Symbol.for("react.memo_cache_sentinel")?(Fe=s.jsx(_,{size:14}),i[64]=Fe):Fe=i[64],i[65]!==te?(Be=s.jsx(o,{icon:Fe,onClick:te,children:"Refresh"}),i[65]=te,i[66]=Be):Be=i[66],i[67]===Symbol.for("react.memo_cache_sentinel")?(Le=s.jsx(j,{size:14}),i[67]=Le):Le=i[67];const We=!de.length;let De,Ee,Ke,Ue,Ve;i[68]!==_e||i[69]!==We?(De=s.jsx(o,{type:"primary",icon:Le,disabled:We,onClick:_e,children:"Download Excel"}),i[68]=_e,i[69]=We,i[70]=De):De=i[70],i[71]!==Be||i[72]!==De?(Ee=s.jsxs(r,{wrap:!0,children:[Be,De]}),i[71]=Be,i[72]=De,i[73]=Ee):Ee=i[73],i[74]!==Me||i[75]!==Ee?(Ke=s.jsxs(l,{justify:"space-between",align:"center",wrap:"wrap",gap:12,style:Ie,children:[Me,Ee]}),i[74]=Me,i[75]=Ee,i[76]=Ke):Ke=i[76],i[77]===Symbol.for("react.memo_cache_sentinel")?(Ue={marginTop:14},i[77]=Ue):Ue=i[77],i[78]===Symbol.for("react.memo_cache_sentinel")?(Ve=s.jsx(g,{size:12}),i[78]=Ve):Ve=i[78];const Xe=ae?.meta?.total_students||0;let qe,Ge,He,Je,Oe,Qe,Ye;return i[79]!==Xe?(qe=s.jsxs(f,{color:"geekblue",icon:Ve,children:["Total Siswa: ",Xe]}),i[79]=Xe,i[80]=qe):qe=i[80],i[81]!==ie.final_average?(Ge=k(ie.final_average),i[81]=ie.final_average,i[82]=Ge):Ge=i[82],i[83]!==Ge?(He=s.jsxs(f,{color:"cyan",children:["Avg Nilai Sumatif: ",Ge]}),i[83]=Ge,i[84]=He):He=i[84],i[85]!==qe||i[86]!==He?(Je=s.jsxs(l,{wrap:"wrap",gap:8,style:Ue,children:[qe,He]}),i[85]=qe,i[86]=He,i[87]=Je):Je=i[87],i[88]!==ve||i[89]!==Ke||i[90]!==Je?(Oe=s.jsxs(a,{style:je,styles:ge,children:[ve,Ke,Je]}),i[88]=ve,i[89]=Ke,i[90]=Je,i[91]=Oe):Oe=i[91],i[92]!==F||i[93]!==fe||i[94]!==q||i[95]!==ee||i[96]!==de||i[97]!==X||i[98]!==E?(Qe=F?q&&!E?s.jsx(h,{type:"info",showIcon:!0,message:"Pilih guru pengampu untuk menampilkan data yang sesuai tampilan guru."}):s.jsx(a,{style:{borderRadius:16},styles:{body:{padding:0}},children:ee||de.length?s.jsx(p,{rowKey:"key",dataSource:de,columns:fe,loading:ee,pagination:!1,size:X.xs?"small":"middle",scroll:{x:2200},sticky:!0}):s.jsx("div",{style:{padding:24},children:s.jsx(u,{description:"Belum ada data nilai pada filter ini."})})}):s.jsx(h,{type:"info",showIcon:!0,message:"Pilih kelas untuk menampilkan rekap nilai."}),i[92]=F,i[93]=fe,i[94]=q,i[95]=ee,i[96]=de,i[97]=X,i[98]=E,i[99]=Qe):Qe=i[99],i[100]!==Oe||i[101]!==Qe?(Ye=s.jsxs(l,{vertical:!0,gap:16,children:[Oe,Qe]}),i[100]=Oe,i[101]=Qe,i[102]=Ye):Ye=i[102],Ye};function v(e,t){return{key:e.student_id,no:t+1,nis:e.nis||"-",full_name:e.full_name,month_scores:e.month_scores||{},final_average:Number(e.final_average||0)}}function I(e){return s.jsx(b,{strong:!0,children:e})}function $(e){const t=String(e.month),a=Math.max(1,Number(e.max_summative_entries||0)),i=e.entries||[];return{title:e.month_name,key:`month-${t}`,children:Array.from({length:a},(e,a)=>{const r=i[a]?.chapter_title||"-",l=i[a]?.slot_key;return[{title:s.jsx(n,{title:r,children:s.jsx("span",{children:`Tertulis ${a+1}`})}),key:`${t}-written-${a}`,width:110,align:"center",render:(e,s)=>{const n=w(s,t,l,a);return n?.score_written??"-"}},{title:s.jsx(n,{title:r,children:s.jsx("span",{children:`Praktik ${a+1}`})}),key:`${t}-skill-${a}`,width:110,align:"center",render:(e,s)=>{const n=w(s,t,l,a);return n?.score_skill??"-"}}]}).flat()}}function N(e){return s.jsx(f,{color:"blue",children:k(e)})}function T(e){return{value:e.id,label:e.full_name}}function P(e){return{value:e.id,label:e.name}}export{S as default};
