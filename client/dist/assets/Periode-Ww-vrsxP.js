import{aA as e,l as a,F as s,bi as i,bj as t,bk as r,bl as n,bm as o,o as d,T as l,aM as c,x as m,B as x,s as p,M as h,z as j}from"./index-BMgVGS0W.js";import{r as f}from"./vendor-kOq7Q5-U.js";import{I as u}from"./InfiniteScrollList-DsHuus8o.js";import{S as g}from"./search-DM2czfgU.js";import{P as b,T as y}from"./trash-2-CUj98Q3w.js";import{M as k}from"./index-CDsHpMr4.js";import{B as v}from"./index-Ie9_wHGB.js";import{C as w}from"./calendar-Buqc-itz.js";import{T as _}from"./index-hPZPoAPD.js";import{P as T}from"./index-BVGPo9j5.js";import{P as C}from"./pencil-B82zEJ2A.js";import"./charts-CwbbN17O.js";import"./index-uTpWdo5L.js";import"./index-CmsZKls5.js";import"./index-FSaxVOpe.js";import"./ActionButton-DfMNmIbJ.js";import"./context-CW6N5AXl.js";import"./useClosable-CyYxAYSl.js";const P=e("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),{Title:S,Text:z}=l,A=({screens:e})=>{const{user:l}=a(e=>e.auth),[A,B]=f.useState(1),[M,L]=f.useState(""),[F,I]=f.useState([]),[E,D]=f.useState(!1),[H,N]=f.useState(null),[G]=s.useForm(),{data:O,isFetching:W,refetch:Y}=i({page:A,limit:10,search:M,homebase_id:l?.homebase_id}),[q,{isLoading:J}]=t(),[R,{isLoading:V}]=r(),[K,{isLoading:Q}]=n(),[U,{isLoading:X}]=o();f.useEffect(()=>{O?.data&&I(1===A?O.data:e=>{const a=O.data.filter(a=>!e.some(e=>e.id===a.id));return[...e,...a]})},[O,A]),f.useEffect(()=>{B(1)},[M]);const Z=(e=null)=>{N(e),e?G.setFieldsValue({name:e.name}):G.resetFields(),D(!0)};return d.jsxs("div",{style:{padding:24},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:e.xs?"flex-start":"center",marginBottom:16,flexWrap:"wrap",gap:10},children:[d.jsx(S,{level:4,style:{margin:0},children:"Daftar Periode"}),d.jsxs(c,{gap:8,vertical:!!e.xs,align:e.xs?"stretch":"center",justify:"flex-end",style:{width:e.xs?"100%":"auto"},children:[d.jsx(m,{placeholder:"Cari periode...",prefix:d.jsx(g,{size:16,color:"#bfbfbf"}),allowClear:!0,onChange:e=>L(e.target.value),style:{width:e.xs?"100%":260}}),d.jsx(x,{type:"primary",icon:d.jsx(b,{size:18}),onClick:()=>Z(null),style:{width:e.xs?"100%":"auto"},children:"Tambah"})]})]}),d.jsx(u,{data:F,loading:W,hasMore:O?.hasMore,onLoadMore:()=>{O?.hasMore&&!W&&B(e=>e+1)},renderItem:e=>d.jsx(v.Ribbon,{text:e.is_active?"Aktif":"Non-Aktif",color:e.is_active?"green":"default",children:d.jsx(p,{hoverable:!0,style:{height:"100%",display:"flex",flexDirection:"column"},styles:{body:{flex:1,padding:"16px"}},actions:[d.jsx(T,{title:"Aktifkan periode ini?",description:"Periode lain dalam satu homebase akan dinonaktifkan.",onConfirm:()=>(async e=>{try{await U(e).unwrap(),j.success("Periode aktif berhasil diubah"),B(1),Y()}catch(a){j.error(a?.data?.message||"Gagal mengaktifkan")}})(e.id),disabled:e.is_active,okText:"Ya, Aktifkan",cancelText:"Batal",children:d.jsx(h,{title:e.is_active?"Sudah Aktif":"Set sebagai Aktif",children:d.jsx(x,{type:"text",icon:d.jsx(P,{size:18,color:e.is_active?"#52c41a":void 0}),disabled:e.is_active})})},"activate"),d.jsx(h,{title:"Edit Nama",children:d.jsx(x,{type:"text",icon:d.jsx(C,{size:18,color:"#faad14"}),onClick:()=>Z(e)})},"edit"),d.jsx(T,{title:"Hapus periode?",description:"Data tidak dapat dikembalikan.",onConfirm:()=>(async e=>{try{await K(e).unwrap(),j.success("Periode dihapus"),B(1),Y()}catch(a){j.error(a?.data?.message||"Gagal menghapus")}})(e.id),okText:"Ya, Hapus",cancelText:"Batal",disabled:e.is_active,children:d.jsx(x,{type:"text",danger:!0,icon:d.jsx(y,{size:18}),disabled:e.is_active,loading:Q})},"delete")],children:d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[d.jsx(w,{size:24,color:"#1890ff",style:{marginTop:4}}),d.jsxs("div",{children:[d.jsx(S,{level:5,style:{margin:0},children:e.name}),d.jsxs(z,{type:"secondary",style:{fontSize:12},children:["Homebase: ",e.homebase_name||"-"]}),d.jsx("div",{style:{marginTop:8},children:e.is_active?d.jsx(_,{color:"success",children:"Sedang Berlangsung"}):d.jsx(_,{color:"default",children:"Arsip"})})]})]})})}),emptyText:"Belum ada data periode",grid:{gutter:[16,16],xs:24,sm:12,md:8,lg:6,xl:6,xxl:4}}),d.jsx(k,{title:H?"Edit Periode":"Tambah Periode Baru",open:E,onCancel:()=>D(!1),onOk:G.submit,confirmLoading:J||V,destroyOnHidden:!0,children:d.jsx(s,{form:G,layout:"vertical",onFinish:async e=>{try{H?(await R({id:H.id,name:e.name,homebase_id:l?.homebase_id}).unwrap(),j.success("Periode berhasil diperbarui")):(await q({name:e.name,homebase_id:l?.homebase_id}).unwrap(),j.success("Periode berhasil ditambahkan")),D(!1),B(1),Y()}catch(a){j.error(a?.data?.message||"Terjadi kesalahan")}},children:d.jsx(s.Item,{name:"name",label:"Nama Periode",rules:[{required:!0,message:"Nama periode wajib diisi"}],help:"Contoh: 2025/2026 Ganjil",children:d.jsx(m,{placeholder:"Masukkan nama periode..."})})})})]})};export{A as default};
