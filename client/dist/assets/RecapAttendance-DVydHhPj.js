import{k as e,ex as a,o as t,X as n,aL as s,s as l,T as r,B as i}from"./index-DJgzJvx0.js";import"./vendor-kOq7Q5-U.js";import{utils as o,writeFile as d}from"./xlsx-3FAc2Sll.js";import{S as c}from"./index-ZAZRIL-n.js";import{A as m}from"./index-D-YBaVh2.js";import{E as u}from"./index-CsPvpU6M.js";import{F as p}from"./Table-Bpp4NRb8.js";import{T as h}from"./index-A8UrXWNV.js";import{F as _}from"./funnel-CQS6Mpx9.js";import{R as x}from"./refresh-ccw-CYu9ftZ8.js";import{D as y}from"./download-CnFHAq_0.js";import{U as b}from"./users-DP4QiVnj.js";import"./charts-4CCI6hAs.js";import"./index-Bjno29EH.js";import"./index-BzygXUWO.js";import"./useClosable-BMlLLbW6.js";const{Title:f,Text:g}=r,j=[{value:1,label:"Januari"},{value:2,label:"Februari"},{value:3,label:"Maret"},{value:4,label:"April"},{value:5,label:"Mei"},{value:6,label:"Juni"},{value:7,label:"Juli"},{value:8,label:"Agustus"},{value:9,label:"September"},{value:10,label:"Oktober"},{value:11,label:"November"},{value:12,label:"Desember"}],S=e=>`${Number(e||0)}%`,w=r=>{const w=e.c(104),{isActive:I,subjectId:T,subject:C,activePeriode:R,classes:P,classLoading:B,classId:E,setClassId:F,semester:H,setSemester:W,isAdminView:D,teacherId:J,setTeacherId:L,teachers:M,teacherLoading:K,screens:O}=r,U=void 0!==D&&D,V=void 0===M?[]:M,X=void 0!==K&&K;let q;w[0]!==E||w[1]!==H||w[2]!==T||w[3]!==J?(q={subjectId:T,classId:E,semester:H,teacherId:J},w[0]=E,w[1]=H,w[2]=T,w[3]=J,w[4]=q):q=w[4];const G=!(I&&T&&E&&H);let Q;w[5]!==G?(Q={skip:G},w[5]=G,w[6]=Q):Q=w[6];const{data:Y,isFetching:Z,refetch:ee}=a(q,Q),ae=Y?.data||null;let te;w[7]!==ae?.meta?(te=ae?.meta||{},w[7]=ae?.meta,w[8]=te):te=w[8];const ne=te;let se;w[9]!==ae?.days?(se=ae?.days||[],w[9]=ae?.days,w[10]=se):se=w[10];const le=se;let re;w[11]!==ae?.students?(re=ae?.students||[],w[11]=ae?.students,w[12]=re):re=w[12];const ie=re;let oe;if(w[13]!==le||w[14]!==ie){let e;w[16]!==le?(e=(e,a)=>{const t={key:e.student_id,no:a+1,nis:e.nis||"-",full_name:e.full_name,summary_hadir:e.summary?.hadir||0,summary_sakit:e.summary?.sakit||0,summary_izin:e.summary?.izin||0,summary_alpa:e.summary?.alpa||0,percent_hadir:e.percent?.hadir||0,percent_sakit:e.percent?.sakit||0,percent_izin:e.percent?.izin||0,percent_alpa:e.percent?.alpa||0};return le.forEach(a=>{t[`day_${a.date}`]=e.daily?.[a.date]||"-"}),t},w[16]=le,w[17]=e):e=w[17],oe=ie.map(e),w[13]=le,w[14]=ie,w[15]=oe}else oe=w[15];const de=oe;let ce;w[18]===Symbol.for("react.memo_cache_sentinel")?(ce=[{title:"No",dataIndex:"no",width:64,fixed:"left",align:"center"},{title:"NIS",dataIndex:"nis",width:120,fixed:"left"},{title:"Nama Siswa",dataIndex:"full_name",width:240,fixed:"left",render:k}],w[18]=ce):ce=w[18];const me=ce;let ue;if(w[19]!==le||w[20]!==ne.months){const e=le.reduce(v,{}),a=(ne.months||[]).map(a=>{const t=Number(a.month||0),n=e[t]||[];return n.length?{title:a.month_name||"-",children:n.map(z)}:null}).filter(Boolean);let t,n;w[22]===Symbol.for("react.memo_cache_sentinel")?(t={title:"Ringkasan",children:[{title:"H",dataIndex:"summary_hadir",width:66,align:"center"},{title:"S",dataIndex:"summary_sakit",width:66,align:"center"},{title:"I",dataIndex:"summary_izin",width:66,align:"center"},{title:"A",dataIndex:"summary_alpa",width:66,align:"center"}]},w[22]=t):t=w[22],w[23]===Symbol.for("react.memo_cache_sentinel")?(n={title:"Presentase (%)",children:[{title:"H",dataIndex:"percent_hadir",width:74,align:"center",render:S},{title:"S",dataIndex:"percent_sakit",width:74,align:"center",render:S},{title:"I",dataIndex:"percent_izin",width:74,align:"center",render:S},{title:"A",dataIndex:"percent_alpa",width:74,align:"center",render:S}]},w[23]=n):n=w[23],ue=[...me,...a.length?a:[{title:"Tanggal",children:[{title:"-",dataIndex:"empty_day",width:64,align:"center",render:A}]}],t,n],w[19]=le,w[20]=ne.months,w[21]=ue}else ue=w[21];const pe=ue;let he;w[24]!==de||w[25]!==E||w[26]!==P||w[27]!==le||w[28]!==H?(he=()=>{if(!de.length)return;const e=de.map(e=>{const a={No:e.no,NIS:e.nis,"Nama Siswa":e.full_name};return le.forEach(t=>{const n=j.find(e=>Number(e.value)===Number(t.month))?.label||"Bulan",s=`${String(t.day).padStart(2,"0")} ${n}`;a[s]=e[`day_${t.date}`]||"-"}),a.H=e.summary_hadir,a.S=e.summary_sakit,a.I=e.summary_izin,a.A=e.summary_alpa,a["%H"]=`${e.percent_hadir}%`,a["%S"]=`${e.percent_sakit}%`,a["%I"]=`${e.percent_izin}%`,a["%A"]=`${e.percent_alpa}%`,a}),a=o.json_to_sheet(e),t=o.book_new();o.book_append_sheet(t,a,"Rekap Absensi");const n=`Rekap_Absensi_Semester_${P.find(e=>String(e.id)===String(E))?.name||"Kelas"}_Semester${H}`.replace(/[\\/:*?"<>|]/g,"-");d(t,`${n}.xlsx`)},w[24]=de,w[25]=E,w[26]=P,w[27]=le,w[28]=H,w[29]=he):he=w[29];const _e=he,xe=s,ye=l;let be,fe,ge;w[30]===Symbol.for("react.memo_cache_sentinel")?(be={borderRadius:16},fe={body:{padding:20}},w[30]=be,w[31]=fe):(be=w[30],fe=w[31]),w[32]===Symbol.for("react.memo_cache_sentinel")?(ge=t.jsxs(n,{direction:"vertical",size:2,children:[t.jsx(f,{level:5,style:{margin:0},children:"Rekapitulasi Absensi"}),t.jsx(g,{type:"secondary",children:"Rekap absensi dalam satu semester berdasarkan periode aktif dan kelas."})]}),w[32]=ge):ge=w[32];const je=C?.name||ne.subject_name||"Mata Pelajaran";let Se;w[33]!==je?(Se=t.jsx(h,{color:"blue",children:je}),w[33]=je,w[34]=Se):Se=w[34];const we=R?.name||ne.periode_name||"Periode";let ke,ve;w[35]!==we?(ke=t.jsx(h,{color:"processing",children:we}),w[35]=we,w[36]=ke):ke=w[36],w[37]!==Se||w[38]!==ke?(ve=t.jsxs(s,{justify:"space-between",align:"center",wrap:"wrap",gap:12,children:[ge,t.jsxs(n,{wrap:!0,children:[Se,ke]})]}),w[37]=Se,w[38]=ke,w[39]=ve):ve=w[39];const Ie=s;let ze;w[40]===Symbol.for("react.memo_cache_sentinel")?(ze={marginTop:16},w[40]=ze):ze=w[40];const Ae=n;let $e,Ne,Te,Ce;w[41]===Symbol.for("react.memo_cache_sentinel")?($e={minWidth:160},Ne=[{value:1,label:"Semester 1"},{value:2,label:"Semester 2"}],Te=t.jsx(_,{size:14}),w[41]=$e,w[42]=Ne,w[43]=Te):($e=w[41],Ne=w[42],Te=w[43]),w[44]!==H||w[45]!==W?(Ce=t.jsx(c,{value:H,onChange:W,style:$e,options:Ne,suffixIcon:Te}),w[44]=H,w[45]=W,w[46]=Ce):Ce=w[46];const Re=U&&(X||V.length>0)&&t.jsx(c,{value:J,onChange:e=>L(e||null),style:{minWidth:220},placeholder:"Semua guru",allowClear:!0,options:[{value:"",label:"Semua guru"},...V.map($)],loading:X});let Pe,Be,Ee,Fe,He,We,De;w[47]===Symbol.for("react.memo_cache_sentinel")?(Pe={minWidth:220},w[47]=Pe):Pe=w[47],w[48]!==P?(Be=P.map(N),w[48]=P,w[49]=Be):Be=w[49],w[50]!==E||w[51]!==B||w[52]!==F||w[53]!==Be?(Ee=t.jsx(c,{value:E,onChange:F,style:Pe,placeholder:"Pilih kelas",options:Be,loading:B}),w[50]=E,w[51]=B,w[52]=F,w[53]=Be,w[54]=Ee):Ee=w[54],w[55]!==Ae||w[56]!==Ce||w[57]!==Re||w[58]!==Ee?(Fe=t.jsxs(Ae,{wrap:true,children:[Ce,Re,Ee]}),w[55]=Ae,w[56]=Ce,w[57]=Re,w[58]=Ee,w[59]=Fe):Fe=w[59],w[60]===Symbol.for("react.memo_cache_sentinel")?(He=t.jsx(x,{size:14}),w[60]=He):He=w[60],w[61]!==ee?(We=t.jsx(i,{icon:He,onClick:()=>ee(),children:"Refresh"}),w[61]=ee,w[62]=We):We=w[62],w[63]===Symbol.for("react.memo_cache_sentinel")?(De=t.jsx(y,{size:14}),w[63]=De):De=w[63];const Je=!de.length;let Le,Me,Ke,Oe,Ue;w[64]!==_e||w[65]!==Je?(Le=t.jsx(i,{type:"primary",icon:De,disabled:Je,onClick:_e,children:"Download Excel"}),w[64]=_e,w[65]=Je,w[66]=Le):Le=w[66],w[67]!==We||w[68]!==Le?(Me=t.jsxs(n,{wrap:!0,children:[We,Le]}),w[67]=We,w[68]=Le,w[69]=Me):Me=w[69],w[70]!==Ie||w[71]!==ze||w[72]!==Fe||w[73]!==Me?(Ke=t.jsxs(Ie,{justify:"space-between",align:"center",wrap:"wrap",gap:12,style:ze,children:[Fe,Me]}),w[70]=Ie,w[71]=ze,w[72]=Fe,w[73]=Me,w[74]=Ke):Ke=w[74],w[75]===Symbol.for("react.memo_cache_sentinel")?(Oe={marginTop:14},w[75]=Oe):Oe=w[75],w[76]===Symbol.for("react.memo_cache_sentinel")?(Ue=t.jsx(b,{size:12}),w[76]=Ue):Ue=w[76];const Ve=ne.total_students||0;let Xe;w[77]!==Ve?(Xe=t.jsxs(h,{color:"geekblue",icon:Ue,children:["Total Siswa: ",Ve]}),w[77]=Ve,w[78]=Xe):Xe=w[78];const qe=ne.total_meetings||0;let Ge;w[79]!==qe?(Ge=t.jsxs(h,{color:"cyan",children:["Total Pertemuan: ",qe]}),w[79]=qe,w[80]=Ge):Ge=w[80];const Qe=ne.semester||H;let Ye,Ze,ea,aa,ta;return w[81]!==Qe?(Ye=t.jsxs(h,{color:"purple",children:["Semester: ",Qe]}),w[81]=Qe,w[82]=Ye):Ye=w[82],w[83]!==Xe||w[84]!==Ge||w[85]!==Ye?(Ze=t.jsxs(s,{wrap:"wrap",gap:8,style:Oe,children:[Xe,Ge,Ye]}),w[83]=Xe,w[84]=Ge,w[85]=Ye,w[86]=Ze):Ze=w[86],w[87]!==ye||w[88]!==be||w[89]!==fe||w[90]!==ve||w[91]!==Ke||w[92]!==Ze?(ea=t.jsxs(ye,{style:be,styles:fe,children:[ve,Ke,Ze]}),w[87]=ye,w[88]=be,w[89]=fe,w[90]=ve,w[91]=Ke,w[92]=Ze,w[93]=ea):ea=w[93],w[94]!==pe||w[95]!==de||w[96]!==E||w[97]!==Z||w[98]!==O?(aa=E?t.jsx(l,{style:{borderRadius:16},styles:{body:{padding:0}},children:Z||de.length?t.jsx(p,{rowKey:"key",dataSource:de,columns:pe,loading:Z,pagination:!1,size:O.xs?"small":"middle",scroll:{x:1200},sticky:!0}):t.jsx("div",{style:{padding:24},children:t.jsx(u,{description:"Belum ada data absensi pada filter ini."})})}):t.jsx(m,{type:"info",showIcon:!0,title:"Pilih kelas untuk menampilkan rekap absensi."}),w[94]=pe,w[95]=de,w[96]=E,w[97]=Z,w[98]=O,w[99]=aa):aa=w[99],w[100]!==xe||w[101]!==ea||w[102]!==aa?(ta=t.jsxs(xe,{vertical:true,gap:16,children:[ea,aa]}),w[100]=xe,w[101]=ea,w[102]=aa,w[103]=ta):ta=w[103],ta};function k(e){return t.jsx(g,{strong:!0,children:e})}function v(e,a){const t=Number(a.month||0);return t?(e[t]||(e[t]=[]),e[t].push(a),e):e}function I(e){return t.jsx(h,{color:(a=e,"H"===a?"green":"T"===a?"gold":"S"===a?"blue":"I"===a?"purple":"A"===a?"red":"default"),style:{marginInlineEnd:0,minWidth:34},children:e});var a}function z(e){return{title:String(e.day).padStart(2,"0"),dataIndex:`day_${e.date}`,key:`day_${e.date}`,width:56,align:"center",render:I}}function A(){return"-"}function $(e){return{value:e.id,label:e.full_name}}function N(e){return{value:e.id,label:e.name}}export{w as default};
