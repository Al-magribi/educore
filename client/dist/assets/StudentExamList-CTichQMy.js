import{az as e,T as s,F as a,a_ as t,o as n,X as r,x as i,B as l,z as o,k as c,a$ as d,s as m,w as u,C as j,a0 as h}from"./index-DJgzJvx0.js";import{I as p,r as x}from"./vendor-kOq7Q5-U.js";import{M as f}from"./index-CWRbA1GH.js";import{A as y}from"./index-D-YBaVh2.js";import{B as k}from"./index-B466D75m.js";import{T as g}from"./index-A8UrXWNV.js";import{B as b}from"./book-open-Bg2XmE5G.js";import{U as _}from"./user-round-BNUrar0_.js";import{T as w}from"./timer-BGBvvTLd.js";import{E as S}from"./index-CsPvpU6M.js";import{C as z}from"./clipboard-list-DE6PC1DM.js";import{G as v}from"./graduation-cap-DX8X8xmD.js";import"./charts-4CCI6hAs.js";import"./ActionButton-DZkZ4UyV.js";import"./context-Co2t6AGx.js";import"./useMergedMask-hWGqm8nf.js";import"./useClosable-BMlLLbW6.js";const M=e("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]),T=e("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]),{Text:C}=s,U=e=>"pelanggaran"===e?{type:"error",title:"Status: Pelanggaran"}:"mengerjakan"===e?{type:"warning",title:"Status: Mengerjakan"}:"selesai"===e?{type:"info",title:"Status: Selesai"}:null,A=async(e,s=2500)=>{const a=new AbortController,t=setTimeout(()=>a.abort(),s);try{const s=await fetch(e,{signal:a.signal,cache:"no-store"});if(!s.ok)return null;const t=await s.json(),n=t?.ip||t?.ip_addr||t?.address;return"string"==typeof n&&n.trim()?n.trim():null}catch(n){return null}finally{clearTimeout(t)}},B=async()=>{if("undefined"==typeof window||"function"!=typeof fetch)return null;const e=["https://api64.ipify.org?format=json","https://api.ipify.org?format=json","https://ifconfig.me/all.json"];for(const s of e){const e=await A(s);if(e)return e}return null},F=({open:e,onClose:s,exam:c})=>{const[d]=a.useForm(),m=p(),[u,{isLoading:j}]=t(),[h,k]=x.useState(null),[g,b]=x.useState(null);x.useEffect(()=>{e&&(d.resetFields(),k(null),b(null),B().then(e=>b(e)))},[e,d]);return n.jsx(f,{title:n.jsxs(r,{align:"center",size:8,children:[n.jsx(T,{size:18}),n.jsx("span",{children:"Masukkan Token Ujian"})]}),open:e,onCancel:s,footer:null,centered:!0,destroyOnHidden:!0,children:n.jsxs(r,{vertical:!0,size:12,style:{width:"100%"},children:[n.jsx(C,{type:"secondary",children:c?.name?`Ujian: ${c.name}`:"Pastikan token sesuai jadwal."}),h&&U(h.status)&&n.jsx(y,{type:U(h.status).type,title:U(h.status).title,description:h.message,showIcon:!0}),n.jsxs(a,{form:d,layout:"vertical",onFinish:async e=>{try{k(null);const a=g||await B();await u({exam_id:c?.id,token:e.token?.trim(),student_ip:a||void 0}).unwrap(),await(async()=>{if("undefined"==typeof document)return!1;if(document.fullscreenElement)return!0;const e=document.documentElement;if(!e?.requestFullscreen)return!1;try{return await e.requestFullscreen(),!0}catch(s){return!1}})(),o.success("Token valid. Selamat mengerjakan ujian."),m(`/computer-based-test/start?exam_id=${c?.id}&exam_name=${c?.name?.replaceAll(" ","-")}`),s()}catch(a){const e=a?.data?.status||null,s=a?.data?.message||"Token ujian tidak valid";e?k({status:e,message:s}):o.error(s)}},children:[n.jsx(a.Item,{label:"Token Ujian",name:"token",rules:[{required:!0,message:"Token ujian wajib diisi"}],children:n.jsx(i,{placeholder:"Masukkan token ujian"})}),n.jsx(C,{type:"secondary",style:{fontSize:12},children:"Status ujian: Belum Masuk = belum mengikuti, Pelanggaran = keluar dari halaman ujian, Mengerjakan = masih berlangsung, Selesai = sudah menjawab semua soal."}),n.jsxs(r,{style:{width:"100%",justifyContent:"flex-end"},children:[n.jsx(l,{onClick:s,children:"Batal"}),n.jsx(l,{type:"primary",htmlType:"submit",loading:j,children:"Verifikasi"})]})]})]})})},{Title:E,Text:I}=s,q=()=>{const e=c.c(36),{data:s,isLoading:a,isError:t}=d(),[i,o]=x.useState(null),[p,f]=x.useState(!1),y=s?.length||0;let T;s?.reduce(P,0),e[0]!==s?(T=new Set((s||[]).map(V).filter(Boolean)),e[0]=s,e[1]=T):T=e[1];const C=T.size,U=s?.[0]?.class_name||"Kelas belum tersedia";if(a){let s;return e[2]===Symbol.for("react.memo_cache_sentinel")?(s=n.jsx(m,{children:n.jsx(h,{active:!0,paragraph:{rows:6}})}),e[2]=s):s=e[2],s}if(t){let s;return e[3]===Symbol.for("react.memo_cache_sentinel")?(s=n.jsx(m,{children:n.jsx(I,{type:"danger",children:"Gagal memuat jadwal ujian."})}),e[3]=s):s=e[3],s}let A;e[4]===Symbol.for("react.memo_cache_sentinel")?(A=e=>{o(e),f(!0)},e[4]=A):A=e[4];const B=A;let q;e[5]===Symbol.for("react.memo_cache_sentinel")?(q=()=>{f(!1),o(null)},e[5]=q):q=e[5];const $=q;let R,D,G,H,J,K,L,N,O,X,Q,W,Y,Z,ee,se,ae;return e[6]===Symbol.for("react.memo_cache_sentinel")?(R={width:"100%"},e[6]=R):R=e[6],e[7]===Symbol.for("react.memo_cache_sentinel")?(D={width:"100%"},e[7]=D):D=e[7],e[8]===Symbol.for("react.memo_cache_sentinel")?(G=n.jsx("div",{style:{width:44,height:44,borderRadius:12,background:"#eef2ff",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx(z,{size:20,color:"#4f46e5"})}),e[8]=G):G=e[8],e[9]===Symbol.for("react.memo_cache_sentinel")?(H=n.jsxs(r,{align:"center",size:12,children:[G,n.jsxs("div",{children:[n.jsx(E,{level:4,style:{margin:0},children:"Jadwal Ujian"}),n.jsx(I,{type:"secondary",children:"Daftar ujian aktif sesuai kelas Anda"})]})]}),e[9]=H):H=e[9],e[10]===Symbol.for("react.memo_cache_sentinel")?(J=n.jsx(v,{size:12}),e[10]=J):J=e[10],e[11]!==U?(K=n.jsx(g,{color:"blue",icon:J,children:U}),e[11]=U,e[12]=K):K=e[12],e[13]===Symbol.for("react.memo_cache_sentinel")?(L=n.jsx(b,{size:12}),e[13]=L):L=e[13],e[14]!==C?(N=n.jsxs(g,{color:"geekblue",icon:L,children:[C," Mapel"]}),e[14]=C,e[15]=N):N=e[15],e[16]===Symbol.for("react.memo_cache_sentinel")?(O=n.jsx(M,{size:12}),e[16]=O):O=e[16],e[17]!==y?(X=n.jsxs(g,{color:"purple",icon:O,children:[y," Ujian Aktif"]}),e[17]=y,e[18]=X):X=e[18],e[19]!==N||e[20]!==X||e[21]!==K?(Q=n.jsx(m,{hoverable:!0,children:n.jsxs(r,{vertical:!0,size:10,style:D,children:[H,n.jsxs(r,{wrap:!0,size:8,children:[K,N,X]})]})}),e[19]=N,e[20]=X,e[21]=K,e[22]=Q):Q=e[22],e[23]===Symbol.for("react.memo_cache_sentinel")?(W=n.jsxs(r,{align:"center",size:8,children:[n.jsx(z,{size:18,color:"#1d4ed8"}),n.jsx("span",{children:"Daftar Ujian"})]}),Y={borderRadius:16},e[23]=W,e[24]=Y):(W=e[23],Y=e[24]),e[25]!==s?(Z=n.jsx(m,{title:W,style:Y,children:s?.length?n.jsx(u,{gutter:[16,16],children:s.map(e=>n.jsx(j,{xs:24,md:12,xl:8,children:n.jsx(k.Ribbon,{text:e.bank_type||"Ujian",children:n.jsx(m,{hoverable:!0,actions:[n.jsx(l,{type:"primary",onClick:()=>B(e),children:"Ikuti Ujian"})],children:n.jsxs(r,{vertical:!0,size:10,style:{width:"100%"},children:[n.jsxs(r,{align:"center",size:8,children:[n.jsx(I,{strong:!0,children:e.name}),n.jsx(g,{color:"green",children:"Aktif"})]}),n.jsxs(r,{size:12,wrap:!0,children:[n.jsxs(I,{type:"secondary",children:[n.jsx(b,{size:14})," ",e.subject_name||"-"]}),n.jsxs(I,{type:"secondary",children:[n.jsx(_,{size:14})," ",e.teacher_name||"-"]}),n.jsxs(I,{type:"secondary",children:[n.jsx(w,{size:14})," ",e.duration_minutes," menit"]})]})]})})})},e.id))}):n.jsx(S,{description:"Belum ada jadwal ujian untuk kelas Anda."})}),e[25]=s,e[26]=Z):Z=e[26],e[27]!==Q||e[28]!==Z?(ee=n.jsxs(r,{vertical:!0,size:20,style:R,children:[Q,Z]}),e[27]=Q,e[28]=Z,e[29]=ee):ee=e[29],e[30]!==i||e[31]!==p?(se=n.jsx(F,{open:p,onClose:$,exam:i}),e[30]=i,e[31]=p,e[32]=se):se=e[32],e[33]!==ee||e[34]!==se?(ae=n.jsxs(n.Fragment,{children:[ee,se]}),e[33]=ee,e[34]=se,e[35]=ae):ae=e[35],ae};function P(e,s){return e+Number(s.duration_minutes||0)}function V(e){return e.subject_name}export{q as default};
