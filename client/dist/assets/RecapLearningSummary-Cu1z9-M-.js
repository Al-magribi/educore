import{k as e,e2 as t,ev as a,eC as s,o as n,s as r,T as l,X as i,aL as c,B as o}from"./index-DJgzJvx0.js";import{r as d}from"./vendor-kOq7Q5-U.js";import{S as m}from"./index-ZAZRIL-n.js";import{F as u}from"./funnel-CQS6Mpx9.js";import{A as p}from"./index-D-YBaVh2.js";import{E as h}from"./index-CsPvpU6M.js";import{F as b}from"./Table-Bpp4NRb8.js";import{T as f}from"./index-A8UrXWNV.js";import{R as j}from"./refresh-ccw-CYu9ftZ8.js";import{U as y}from"./users-DP4QiVnj.js";import"./charts-4CCI6hAs.js";import"./index-Bjno29EH.js";import"./index-BzygXUWO.js";import"./useClosable-BMlLLbW6.js";const{Title:g,Text:x}=l,_=e=>{const t=String(e||"").trim();if(!t||"-"===t)return"Lainnya";const a=t.match(/^(\d{1,2})/);return a?.[1]||"Lainnya"},S=(e,t)=>String(e).localeCompare(String(t),"id",{numeric:!0,sensitivity:"base"}),w=(e,t)=>"Lainnya"===e?1:"Lainnya"===t?-1:Number(e)-Number(t),v=(e=[])=>[...new Set(e.map(e=>_(e)))].sort(w)[0]||"Lainnya",k=l=>{const _=e.c(91),{isActive:S,subjectId:w,subject:v,activePeriode:k,screens:N}=l,[B,R]=d.useState("all"),[F,W]=d.useState("all"),K="all"===B?null:Number(B)||null,E="all"===F?null:Number(F)||null;let G;_[0]!==w?(G={subjectId:w,gradeId:null},_[0]=w,_[1]=G):G=_[1];const O=!S||!w;let U;_[2]!==O?(U={skip:O},_[2]=O,_[3]=U):U=_[3];const{data:X,isLoading:q}=t(G,U);let D;_[4]!==X?.data?(D=X?.data||[],_[4]=X?.data,_[5]=D):D=_[5];const H=D;let J;_[6]!==K||_[7]!==w?(J={subjectId:w,classId:K},_[6]=K,_[7]=w,_[8]=J):J=_[8];const Q=!S||!w;let V;_[9]!==Q?(V={skip:Q},_[9]=Q,_[10]=V):V=_[10];const{data:Y,isLoading:Z}=a(J,V);let ee;_[11]!==Y?.data?(ee=Y?.data||[],_[11]=Y?.data,_[12]=ee):ee=_[12];const te=ee;let ae,se;_[13]===Symbol.for("react.memo_cache_sentinel")?(ae={value:"all",label:"Semua kelas"},_[13]=ae):ae=_[13],_[14]!==H?(se=[ae,...H.map(I)],_[14]=H,_[15]=se):se=_[15];const ne=se;let re,le;_[16]===Symbol.for("react.memo_cache_sentinel")?(re={value:"all",label:"Semua guru"},_[16]=re):re=_[16],_[17]!==te?(le=[re,...te.map(M)],_[17]=te,_[18]=le):le=_[18];const ie=le;let ce;e:{if("all"===B){ce="all";break e}let e;_[19]!==H||_[20]!==B?(e=H.some(e=>String(e.id)===String(B))?String(B):"all",_[19]=H,_[20]=B,_[21]=e):e=_[21],ce=e}const oe=ce;let de;e:{if("all"===F){de="all";break e}let e;_[22]!==F||_[23]!==te?(e=te.some(e=>String(e.id)===String(F))?String(F):"all",_[22]=F,_[23]=te,_[24]=e):e=_[24],de=e}const me=de;let ue;_[25]!==K||_[26]!==E||_[27]!==w?(ue={subjectId:w,teacherId:E,classId:K},_[25]=K,_[26]=E,_[27]=w,_[28]=ue):ue=_[28];const pe=!S||!w;let he;_[29]!==pe?(he={skip:pe},_[29]=pe,_[30]=he):he=_[30];const{data:be,isFetching:fe,refetch:je}=s(ue,he);let ye;_[31]!==be?.data?(ye=be?.data||{},_[31]=be?.data,_[32]=ye):ye=_[32];const ge=ye;let xe;_[33]!==ge?.items?(xe=ge?.items||[],_[33]=ge?.items,_[34]=xe):xe=_[34];const _e=xe;let Se;if(_[35]!==_e){const e=new Map;for(const t of _e){const a=String(t.chapter_id??t.chapter_title??t.key??e.size+1);e.has(a)||e.set(a,{key:a,chapter_title:t.chapter_title||"-",teachersMap:new Map,subchaptersMap:new Map,classNamesSet:new Set});const s=e.get(a),n=t.class_name||"-";"-"!==n&&s.classNamesSet.add(n);for(const e of t.teachers||[]){const t=String(e.id??e.full_name);s.teachersMap.has(t)||s.teachersMap.set(t,e)}for(const e of t.subchapters||[]){const t=String(e.id??e.title);s.subchaptersMap.has(t)||s.subchaptersMap.set(t,e)}}Se=Array.from(e.values()).map(z).sort(L).map(T),_[35]=_e,_[36]=Se}else Se=_[36];const we=Se;let ve;_[37]===Symbol.for("react.memo_cache_sentinel")?(ve=[{title:"No",dataIndex:"no",width:56,align:"center"},{title:"Bab",dataIndex:"chapter_title",render:C},{title:"Subbab",dataIndex:"subchapters",render:A},{title:"Guru",dataIndex:"teachers",render:P},{title:"Kelas Peruntukan",dataIndex:"class_names",render:$}],_[37]=ve):ve=_[37];const ke=ve;let Ie;_[38]===Symbol.for("react.memo_cache_sentinel")?(Ie=e=>{R(e),W("all")},_[38]=Ie):Ie=_[38];const Me=Ie;let ze,Le,Te;_[39]===Symbol.for("react.memo_cache_sentinel")?(ze={borderRadius:16},Le={body:{padding:20}},_[39]=ze,_[40]=Le):(ze=_[39],Le=_[40]),_[41]===Symbol.for("react.memo_cache_sentinel")?(Te=n.jsxs(i,{vertical:!0,size:2,children:[n.jsx(g,{level:5,style:{margin:0},children:"Ringkasan Pembelajaran"}),n.jsx(x,{type:"secondary",children:"Bab dan subbab yang sudah dibuat guru pengampu sesuai peruntukan kelas"})]}),_[41]=Te):Te=_[41];const Ce=v?.name||"Mata Pelajaran";let Ne;_[42]!==Ce?(Ne=n.jsx(f,{color:"blue",children:Ce}),_[42]=Ce,_[43]=Ne):Ne=_[43];const Ae=k?.name||ge?.meta?.periode_name||"Periode";let Be,Pe,Re,Fe,We,$e,Ke,Ee,Ge,Oe,Ue,Xe,qe;_[44]!==Ae?(Be=n.jsx(f,{color:"processing",children:Ae}),_[44]=Ae,_[45]=Be):Be=_[45],_[46]!==Ne||_[47]!==Be?(Pe=n.jsxs(c,{justify:"space-between",align:"center",wrap:"wrap",gap:12,children:[Te,n.jsxs(i,{wrap:!0,children:[Ne,Be]})]}),_[46]=Ne,_[47]=Be,_[48]=Pe):Pe=_[48],_[49]===Symbol.for("react.memo_cache_sentinel")?(Re={marginTop:16},_[49]=Re):Re=_[49],_[50]===Symbol.for("react.memo_cache_sentinel")?(Fe={minWidth:220},_[50]=Fe):Fe=_[50],_[51]===Symbol.for("react.memo_cache_sentinel")?(We=n.jsx(u,{size:14}),_[51]=We):We=_[51],_[52]!==q||_[53]!==ne||_[54]!==oe?($e=n.jsx(m,{value:oe,onChange:Me,style:Fe,options:ne,loading:q,suffixIcon:We}),_[52]=q,_[53]=ne,_[54]=oe,_[55]=$e):$e=_[55],_[56]!==Z||_[57]!==ie||_[58]!==te.length||_[59]!==me?(Ke=te.length>1&&n.jsx(m,{value:me,onChange:W,style:{minWidth:240},options:ie,loading:Z,suffixIcon:n.jsx(u,{size:14})}),_[56]=Z,_[57]=ie,_[58]=te.length,_[59]=me,_[60]=Ke):Ke=_[60],_[61]!==$e||_[62]!==Ke?(Ee=n.jsxs(i,{wrap:!0,children:[$e,Ke]}),_[61]=$e,_[62]=Ke,_[63]=Ee):Ee=_[63],_[64]===Symbol.for("react.memo_cache_sentinel")?(Ge=n.jsx(j,{size:14}),_[64]=Ge):Ge=_[64],_[65]!==je?(Oe=n.jsx(o,{icon:Ge,onClick:je,children:"Refresh"}),_[65]=je,_[66]=Oe):Oe=_[66],_[67]!==Ee||_[68]!==Oe?(Ue=n.jsxs(c,{justify:"space-between",align:"center",wrap:"wrap",gap:12,style:Re,children:[Ee,Oe]}),_[67]=Ee,_[68]=Oe,_[69]=Ue):Ue=_[69],_[70]===Symbol.for("react.memo_cache_sentinel")?(Xe={marginTop:14},_[70]=Xe):Xe=_[70],_[71]===Symbol.for("react.memo_cache_sentinel")?(qe=n.jsx(y,{size:12}),_[71]=qe):qe=_[71];const De=ge?.meta?.total_chapters||0;let He;_[72]!==De?(He=n.jsxs(f,{color:"geekblue",icon:qe,children:["Total Bab: ",De]}),_[72]=De,_[73]=He):He=_[73];const Je=ge?.meta?.total_subchapters||0;let Qe,Ve,Ye,Ze,et;return _[74]!==Je?(Qe=n.jsxs(f,{color:"cyan",children:["Total Subbab: ",Je]}),_[74]=Je,_[75]=Qe):Qe=_[75],_[76]!==He||_[77]!==Qe?(Ve=n.jsxs(c,{wrap:"wrap",gap:8,style:Xe,children:[He,Qe]}),_[76]=He,_[77]=Qe,_[78]=Ve):Ve=_[78],_[79]!==Pe||_[80]!==Ue||_[81]!==Ve?(Ye=n.jsxs(r,{style:ze,styles:Le,children:[Pe,Ue,Ve]}),_[79]=Pe,_[80]=Ue,_[81]=Ve,_[82]=Ye):Ye=_[82],_[83]!==fe||_[84]!==we||_[85]!==N?.xs||_[86]!==w?(Ze=w?n.jsx(r,{style:{borderRadius:16},styles:{body:{padding:0}},children:fe||we.length?n.jsx(b,{rowKey:"key",dataSource:we,columns:ke,loading:fe,pagination:!1,size:N?.xs?"small":"middle",sticky:!0}):n.jsx("div",{style:{padding:24},children:n.jsx(h,{description:"Belum ada data bab/subbab pada filter ini."})})}):n.jsx(p,{type:"info",showIcon:!0,message:"Mata pelajaran belum dipilih."}),_[83]=fe,_[84]=we,_[85]=N?.xs,_[86]=w,_[87]=Ze):Ze=_[87],_[88]!==Ye||_[89]!==Ze?(et=n.jsxs(c,{vertical:!0,gap:16,children:[Ye,Ze]}),_[88]=Ye,_[89]=Ze,_[90]=et):et=_[90],et};function I(e){return{value:String(e.id),label:e.name}}function M(e){return{value:String(e.id),label:e.full_name}}function z(e){const t=Array.from(e.classNamesSet).sort(S);return{key:e.key,chapter_title:e.chapter_title,teachers:Array.from(e.teachersMap.values()),subchapters:Array.from(e.subchaptersMap.values()),class_names:t,primary_level:v(t)}}function L(e,t){const a=w(e.primary_level,t.primary_level);if(0!==a)return a;const s=e.class_names[0]||"",n=t.class_names[0]||"",r=S(s,n);return 0!==r?r:String(e.chapter_title).localeCompare(String(t.chapter_title),"id",{numeric:!0,sensitivity:"base"})}function T(e,t){return{...e,no:t+1}}function C(e){return n.jsx(x,{strong:!0,children:e})}function N(e){return n.jsx(f,{color:"blue",children:e.title},e.id)}function A(e){return e?.length?n.jsx(i,{size:[4,4],wrap:!0,children:e.map(N)}):n.jsx(x,{type:"secondary",children:"Belum ada subbab"})}function B(e){return n.jsx(f,{children:e.full_name},e.id)}function P(e){return e?.length?n.jsx(i,{size:[4,4],wrap:!0,children:e.map(B)}):"-"}function R(e,t){const a=_(t);return e[a]||(e[a]=[]),e[a].push(t),e}function F(e,t){const[a]=e,[s]=t;return w(a,s)}function W(e){const[t,a]=e;return n.jsxs(i,{align:"start",wrap:!0,children:[n.jsx(x,{type:"secondary",style:{minWidth:72},children:"Lainnya"===t?"Lainnya":`Tingkat ${t}`}),n.jsx(i,{size:[4,4],wrap:!0,children:[...new Set(a)].sort(S).map(e=>n.jsx(f,{children:e},`${t}-${e}`))})]},t)}function $(e){if(!e?.length)return n.jsx(x,{type:"secondary",children:"-"});const t=e.reduce(R,{}),a=Object.entries(t).sort(F);return n.jsx(i,{direction:"vertical",size:4,children:a.map(W)})}export{k as default};
