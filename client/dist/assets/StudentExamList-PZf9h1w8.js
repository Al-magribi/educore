import{aA as e,T as s,F as n,b2 as t,o as a,X as r,x as i,B as l,z as o,k as c,b3 as d,s as m,w as u,C as j,a0 as h}from"./index-TxbSs64b.js";import{I as p,r as x}from"./vendor-kOq7Q5-U.js";import{M as f}from"./index-BttLdxdX.js";import{A as y}from"./index-4D19nP98.js";import{B as k}from"./index-CqzJRsM-.js";import{T as g}from"./index-Dj0znD7j.js";import{B as b}from"./book-open-BkXHhX8D.js";import{U as _}from"./user-round-BdKZMno4.js";import{T as w}from"./timer-CJIFQqed.js";import{E as S}from"./index-CVJ5d8Nu.js";import{C as z}from"./clipboard-list-BVexXAgl.js";import{G as v}from"./graduation-cap-BRCmN7fF.js";import"./charts-DTgBacDZ.js";import"./ActionButton-4PjL455O.js";import"./context-K0_FAUKW.js";import"./useClosable-y2z-qVwf.js";const T=e("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]),M=e("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]),{Text:C}=s,A=e=>"pelanggaran"===e?{type:"error",title:"Status: Pelanggaran"}:"mengerjakan"===e?{type:"warning",title:"Status: Mengerjakan"}:"selesai"===e?{type:"info",title:"Status: Selesai"}:null,U=async(e,s=2500)=>{const n=new AbortController,t=setTimeout(()=>n.abort(),s);try{const s=await fetch(e,{signal:n.signal,cache:"no-store"});if(!s.ok)return null;const t=await s.json(),a=t?.ip||t?.ip_addr||t?.address;return"string"==typeof a&&a.trim()?a.trim():null}catch(a){return null}finally{clearTimeout(t)}},B=async()=>{if("undefined"==typeof window||"function"!=typeof fetch)return null;const e=["https://api64.ipify.org?format=json","https://api.ipify.org?format=json","https://ifconfig.me/all.json"];for(const s of e){const e=await U(s);if(e)return e}return null},F=({open:e,onClose:s,exam:c})=>{const[d]=n.useForm(),m=p(),[u,{isLoading:j}]=t(),[h,k]=x.useState(null),[g,b]=x.useState(null);x.useEffect(()=>{e&&(d.resetFields(),k(null),b(null),B().then(e=>b(e)))},[e,d]);return a.jsx(f,{title:a.jsxs(r,{align:"center",size:8,children:[a.jsx(M,{size:18}),a.jsx("span",{children:"Masukkan Token Ujian"})]}),open:e,onCancel:s,footer:null,centered:!0,destroyOnHidden:!0,children:a.jsxs(r,{vertical:!0,size:12,style:{width:"100%"},children:[a.jsx(C,{type:"secondary",children:c?.name?`Ujian: ${c.name}`:"Pastikan token sesuai jadwal."}),h&&A(h.status)&&a.jsx(y,{type:A(h.status).type,title:A(h.status).title,description:h.message,showIcon:!0}),a.jsxs(n,{form:d,layout:"vertical",onFinish:async e=>{try{k(null);const n=g||await B();await u({exam_id:c?.id,token:e.token?.trim(),student_ip:n||void 0}).unwrap(),await(async()=>{if("undefined"==typeof document)return!1;if(document.fullscreenElement)return!0;const e=document.documentElement;if(!e?.requestFullscreen)return!1;try{return await e.requestFullscreen(),!0}catch(s){return!1}})(),o.success("Token valid. Selamat mengerjakan ujian."),m(`/computer-based-test/start?exam_id=${c?.id}&exam_name=${c?.name?.replaceAll(" ","-")}`),s()}catch(n){const e=n?.data?.status||null,s=n?.data?.message||"Token ujian tidak valid";e?k({status:e,message:s}):o.error(s)}},children:[a.jsx(n.Item,{label:"Token Ujian",name:"token",rules:[{required:!0,message:"Token ujian wajib diisi"}],children:a.jsx(i,{placeholder:"Masukkan token ujian"})}),a.jsx(C,{type:"secondary",style:{fontSize:12},children:"Status ujian: Belum Masuk = belum mengikuti, Pelanggaran = keluar dari halaman ujian, Mengerjakan = masih berlangsung, Selesai = sudah menjawab semua soal."}),a.jsxs(r,{style:{width:"100%",justifyContent:"flex-end"},children:[a.jsx(l,{onClick:s,children:"Batal"}),a.jsx(l,{type:"primary",htmlType:"submit",loading:j,children:"Verifikasi"})]})]})]})})},{Title:E,Text:q}=s,I=()=>{const e=c.c(36),{data:s,isLoading:n,isError:t}=d(),[i,o]=x.useState(null),[p,f]=x.useState(!1),y=s?.length||0;let M;s?.reduce(P,0),e[0]!==s?(M=new Set((s||[]).map(D).filter(Boolean)),e[0]=s,e[1]=M):M=e[1];const C=M.size,A=s?.[0]?.class_name||"Kelas belum tersedia";if(n){let s;return e[2]===Symbol.for("react.memo_cache_sentinel")?(s=a.jsx(m,{children:a.jsx(h,{active:!0,paragraph:{rows:6}})}),e[2]=s):s=e[2],s}if(t){let s;return e[3]===Symbol.for("react.memo_cache_sentinel")?(s=a.jsx(m,{children:a.jsx(q,{type:"danger",children:"Gagal memuat jadwal ujian."})}),e[3]=s):s=e[3],s}let U;e[4]===Symbol.for("react.memo_cache_sentinel")?(U=e=>{o(e),f(!0)},e[4]=U):U=e[4];const B=U;let I;e[5]===Symbol.for("react.memo_cache_sentinel")?(I=()=>{f(!1),o(null)},e[5]=I):I=e[5];const R=I;let V,$,G,H,J,L,N,O,K,X,Q,W,Y,Z,ee,se,ne;return e[6]===Symbol.for("react.memo_cache_sentinel")?(V={width:"100%"},e[6]=V):V=e[6],e[7]===Symbol.for("react.memo_cache_sentinel")?($={width:"100%"},e[7]=$):$=e[7],e[8]===Symbol.for("react.memo_cache_sentinel")?(G=a.jsx("div",{style:{width:44,height:44,borderRadius:12,background:"#eef2ff",display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(z,{size:20,color:"#4f46e5"})}),e[8]=G):G=e[8],e[9]===Symbol.for("react.memo_cache_sentinel")?(H=a.jsxs(r,{align:"center",size:12,children:[G,a.jsxs("div",{children:[a.jsx(E,{level:4,style:{margin:0},children:"Jadwal Ujian"}),a.jsx(q,{type:"secondary",children:"Daftar ujian aktif sesuai kelas Anda"})]})]}),e[9]=H):H=e[9],e[10]===Symbol.for("react.memo_cache_sentinel")?(J=a.jsx(v,{size:12}),e[10]=J):J=e[10],e[11]!==A?(L=a.jsx(g,{color:"blue",icon:J,children:A}),e[11]=A,e[12]=L):L=e[12],e[13]===Symbol.for("react.memo_cache_sentinel")?(N=a.jsx(b,{size:12}),e[13]=N):N=e[13],e[14]!==C?(O=a.jsxs(g,{color:"geekblue",icon:N,children:[C," Mapel"]}),e[14]=C,e[15]=O):O=e[15],e[16]===Symbol.for("react.memo_cache_sentinel")?(K=a.jsx(T,{size:12}),e[16]=K):K=e[16],e[17]!==y?(X=a.jsxs(g,{color:"purple",icon:K,children:[y," Ujian Aktif"]}),e[17]=y,e[18]=X):X=e[18],e[19]!==O||e[20]!==X||e[21]!==L?(Q=a.jsx(m,{hoverable:!0,children:a.jsxs(r,{vertical:!0,size:10,style:$,children:[H,a.jsxs(r,{wrap:!0,size:8,children:[L,O,X]})]})}),e[19]=O,e[20]=X,e[21]=L,e[22]=Q):Q=e[22],e[23]===Symbol.for("react.memo_cache_sentinel")?(W=a.jsxs(r,{align:"center",size:8,children:[a.jsx(z,{size:18,color:"#1d4ed8"}),a.jsx("span",{children:"Daftar Ujian"})]}),Y={borderRadius:16},e[23]=W,e[24]=Y):(W=e[23],Y=e[24]),e[25]!==s?(Z=a.jsx(m,{title:W,style:Y,children:s?.length?a.jsx(u,{gutter:[16,16],children:s.map(e=>a.jsx(j,{xs:24,md:12,xl:8,children:a.jsx(k.Ribbon,{text:e.bank_type||"Ujian",children:a.jsx(m,{hoverable:!0,actions:[a.jsx(l,{type:"primary",onClick:()=>B(e),children:"Ikuti Ujian"})],children:a.jsxs(r,{vertical:!0,size:10,style:{width:"100%"},children:[a.jsxs(r,{align:"center",size:8,children:[a.jsx(q,{strong:!0,children:e.name}),a.jsx(g,{color:"green",children:"Aktif"})]}),a.jsxs(r,{size:12,wrap:!0,children:[a.jsxs(q,{type:"secondary",children:[a.jsx(b,{size:14})," ",e.subject_name||"-"]}),a.jsxs(q,{type:"secondary",children:[a.jsx(_,{size:14})," ",e.teacher_name||"-"]}),a.jsxs(q,{type:"secondary",children:[a.jsx(w,{size:14})," ",e.duration_minutes," menit"]})]})]})})})},e.id))}):a.jsx(S,{description:"Belum ada jadwal ujian untuk kelas Anda."})}),e[25]=s,e[26]=Z):Z=e[26],e[27]!==Q||e[28]!==Z?(ee=a.jsxs(r,{vertical:!0,size:20,style:V,children:[Q,Z]}),e[27]=Q,e[28]=Z,e[29]=ee):ee=e[29],e[30]!==i||e[31]!==p?(se=a.jsx(F,{open:p,onClose:R,exam:i}),e[30]=i,e[31]=p,e[32]=se):se=e[32],e[33]!==ee||e[34]!==se?(ne=a.jsxs(a.Fragment,{children:[ee,se]}),e[33]=ee,e[34]=se,e[35]=ne):ne=e[35],ne};function P(e,s){return e+Number(s.duration_minutes||0)}function D(e){return e.subject_name}export{I as default};
